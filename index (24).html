<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼ä¸šçº§å·¥ä½œå‘¨æŠ¥ç³»ç»Ÿ V11 - å¤šå±‚çº§ä»ªè¡¨æ¿</title>
    
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js"></script>
    
    <!-- Firebaseåº“åŠ è½½æ£€æŸ¥ -->
    <script>
        console.log('æ£€æŸ¥Firebaseåº“åŠ è½½...');
        let firebaseCheckAttempts = 0;
        const maxAttempts = 10;
        
        function checkFirebaseLoaded() {
            firebaseCheckAttempts++;
            console.log('Firebaseåº“åŠ è½½æ£€æŸ¥ (#' + firebaseCheckAttempts + '):', typeof firebase);
            
            if (typeof firebase !== 'undefined' && firebase.initializeApp) {
                console.log('âœ“ Firebaseåº“å·²æˆåŠŸåŠ è½½');
                return true;
            }
            
            if (firebaseCheckAttempts < maxAttempts) {
                setTimeout(checkFirebaseLoaded, 500);
                return false;
            }
            
            console.error('âœ— Firebaseåº“åŠ è½½å¤±è´¥ï¼Œå°è¯•æ¬¡æ•°å·²è¾¾ä¸Šé™');
            return false;
        }
        
        // ç«‹å³æ£€æŸ¥ä¸€æ¬¡
        checkFirebaseLoaded();
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans CJK SC', sans-serif; background: #f9fafb; }
        .container { max-width: 1600px; margin: 0 auto; background: white; min-height: 100vh; }
        
        /* å¤´éƒ¨ */
        .header { background: #1f2937; color: white; padding: 20px 24px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 22px; display: flex; align-items: center; gap: 12px; }
        .header p { font-size: 13px; opacity: 0.8; margin-top: 4px; }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .avatar { width: 36px; height: 36px; border-radius: 50%; background: #2563eb; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .role-badge { display: inline-block; padding: 4px 12px; background: #10b981; color: white; border-radius: 20px; font-size: 11px; font-weight: 600; margin-left: 8px; }
        .role-badge.pending { background: #f59e0b; }
        .role-badge.admin { background: #ef4444; }
        .role-badge.leader { background: #8b5cf6; }
        .role-badge.user { background: #2563eb; }
        
        /* ç™»å½•é¡µ */
        .login-page { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; min-height: 100vh; }
        .login-box { text-align: center; max-width: 400px; }
        .login-box h1 { font-size: 48px; margin-bottom: 10px; }
        .login-box h2 { font-size: 24px; margin-bottom: 5px; color: #1f2937; }
        .login-box p { color: #6b7280; margin-bottom: 30px; }
        .google-btn { padding: 14px 28px; background: white; border: 1px solid #dadce0; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; }
        .google-btn:hover { background: #f8f9fa; }
        
        /* å¾…å®¡æ‰¹é¡µ */
        .pending-page { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; min-height: 100vh; }
        .pending-box { text-align: center; max-width: 500px; background: #f9fafb; padding: 40px; border-radius: 12px; border: 2px solid #f59e0b; }
        .pending-box h2 { font-size: 24px; margin-bottom: 20px; color: #1f2937; }
        
        /* ä¸»å†…å®¹ */
        .main-page { display: none; }
        .main-page.active { display: block; }
        .content { padding: 24px; }
        
        /* é€‰é¡¹å¡ */
        .tabs { display: flex; gap: 8px; border-bottom: 1px solid #e5e7eb; margin-bottom: 24px; overflow-x: auto; }
        .tab-btn { padding: 12px 24px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: #6b7280; font-size: 14px; white-space: nowrap; }
        .tab-btn.active { color: #2563eb; border-bottom-color: #2563eb; }
        
        /* ä»ªè¡¨æ¿ */
        .dashboard { display: none; }
        .dashboard.active { display: block; }
        
        .filter-row { background: #f9fafb; padding: 16px; border-radius: 8px; margin-bottom: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; border: 1px solid #e5e7eb; }
        .filter-group { display: flex; flex-direction: column; gap: 4px; }
        .filter-group label { font-size: 12px; font-weight: 600; color: #374151; }
        .filter-group input, .filter-group select { padding: 8px; border: 1px solid #e5e7eb; border-radius: 4px; font-size: 13px; }
        
        .action-buttons { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 24px; }
        .stat-card { background: #f9fafb; padding: 14px; border-radius: 8px; border-left: 3px solid #2563eb; }
        .stat-label { font-size: 12px; color: #6b7280; margin-bottom: 4px; }
        .stat-value { font-size: 22px; font-weight: 700; color: #2563eb; }
        .stat-sub { font-size: 12px; color: #6b7280; margin-top: 4px; }
        
        .dashboard-section { margin-bottom: 32px; }
        .dashboard-section h3 { font-size: 16px; font-weight: 700; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #e5e7eb; }
        
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .summary-card { background: white; border: 1px solid #e5e7eb; padding: 16px; border-radius: 8px; }
        .summary-card strong { display: block; color: #111827; font-size: 13px; margin-bottom: 8px; }
        .summary-card .amount { font-size: 20px; font-weight: 700; color: #2563eb; }
        .summary-card .sub { font-size: 12px; color: #6b7280; margin-top: 4px; }
        
        /* è¡¨å• */
        .form-section { display: none; }
        .form-section.active { display: block; }
        
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px; }
        .form-row.full { grid-template-columns: 1fr; }
        .form-group { display: flex; flex-direction: column; gap: 6px; }
        .form-group label { font-weight: 600; font-size: 13px; }
        .form-group input, .form-group select, .form-group textarea { padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 4px; font-size: 13px; font-family: inherit; }
        .form-group textarea { resize: vertical; min-height: 60px; }
        
        .form-buttons { display: flex; gap: 12px; margin-top: 20px; }
        .form-buttons button { flex: 1; }
        
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.2s; }
        .btn-primary { background: #2563eb; color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-secondary { background: #e5e7eb; color: #374151; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-logout { background: #6b7280; color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        
        /* è¡¨æ ¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 16px; font-size: 13px; }
        th { text-align: left; padding: 12px; border-bottom: 2px solid #e5e7eb; background: #f9fafb; font-weight: 600; }
        td { padding: 12px; border-bottom: 1px solid #e5e7eb; }
        tr:hover { background: #f9fafb; }
        
        .badge { display: inline-block; padding: 3px 10px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .badge-network { background: #dbeafe; color: #1e40af; }
        .badge-system { background: #dcfce7; color: #166534; }
        .badge-infra { background: #fecaca; color: #991b1b; }
        .badge-active { background: #dcfce7; color: #166534; }
        .badge-pending { background: #fef3c7; color: #92400e; }
        
        /* æ¨¡æ€æ¡† */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000; overflow-y: auto; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 24px; border-radius: 12px; width: 90%; max-width: 600px; margin: 20px auto; }
        .modal-header { font-size: 18px; font-weight: 700; margin-bottom: 20px; }
        
        .info-box { background: #f0f4ff; border-left: 4px solid #2563eb; padding: 16px; border-radius: 8px; margin-top: 20px; }
        .info-box h3 { color: #2563eb; margin-bottom: 8px; }
        .info-box p { font-size: 13px; color: #374151; margin: 4px 0; }
        
        .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        .role-label { display: inline-block; padding: 4px 8px; background: #e0e7ff; color: #2563eb; border-radius: 3px; font-size: 11px; font-weight: 600; }
        
        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
            .summary-grid { grid-template-columns: 1fr; }
            .filter-row { grid-template-columns: 1fr; }
            .action-buttons { flex-direction: column; }
            .tabs { overflow-x: auto; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <div>
                <h1>ğŸ“Š ä¼ä¸šçº§å·¥ä½œå‘¨æŠ¥ç³»ç»Ÿ V11</h1>
                <p>å¤šå±‚çº§ä»ªè¡¨æ¿ Â· æ™ºèƒ½æ•°æ®å±•ç¤º Â· å…¨æ™¯ç»Ÿè®¡åˆ†æ</p>
            </div>
            <div id="userSection" style="display: none; display: flex; align-items: center; gap: 16px;">
                <div class="user-info">
                    <div class="avatar" id="userAvatar">ç”¨</div>
                    <div>
                        <div id="userName" style="font-weight: 600; font-size: 13px;">ç”¨æˆ·</div>
                        <div id="userEmail" style="font-size: 12px; opacity: 0.8;">é‚®ç®±</div>
                    </div>
                    <span class="role-badge user" id="roleBadge">ç”¨æˆ·</span>
                </div>
                <button class="btn btn-secondary btn-sm" onclick="openUserProfileModal()">âš™ï¸ è®¾ç½®</button>
                <button class="btn btn-logout" onclick="logout()">ç™»å‡º</button>
            </div>
        </div>

        <!-- ç™»å½•é¡µ -->
        <div id="loginPage" class="login-page">
            <div class="login-box">
                <h1>ğŸ“Š</h1>
                <h2>ä¼ä¸šçº§å·¥ä½œå‘¨æŠ¥ç³»ç»Ÿ</h2>
                <p>V11 å¤šå±‚çº§ä»ªè¡¨æ¿ç‰ˆ Â· å…¨æ™¯ç»Ÿè®¡ Â· æ™ºèƒ½åˆ†æ</p>
                <button class="google-btn" onclick="signInWithGoogle()">ğŸ” ä½¿ç”¨Googleè´¦æˆ·ç™»å½•</button>
                <p style="margin-top: 16px; color: #9ca3af; font-size: 13px;">ç™»å½•åéœ€ç®¡ç†å‘˜å®¡æ‰¹æ¿€æ´»</p>
            </div>
        </div>

        <!-- å¾…å®¡æ‰¹é¡µ -->
        <div id="pendingPage" class="pending-page">
            <div class="pending-box">
                <h2>â³ è´¦å·å®¡æ‰¹ä¸­</h2>
                <p>ä½ çš„è´¦å·å·²æäº¤å®¡æ‰¹ï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜æ¿€æ´»ã€‚</p>
                <p style="margin-top: 20px; padding: 16px; background: white; border-radius: 8px; border-left: 4px solid #f59e0b;">
                    <strong>ä½ çš„ä¿¡æ¯ï¼š</strong><br>
                    å§“åï¼š<span id="pendingName">æœªè®¾ç½®</span><br>
                    é‚®ç®±ï¼š<span id="pendingEmail">æœªè®¾ç½®</span><br>
                    éƒ¨é—¨ï¼š<span id="pendingDept">æœªè®¾ç½®</span><br>
                    ä¸“ä¸šæ–¹å‘ï¼š<span id="pendingSpecialty">æœªè®¾ç½®</span>
                </p>
                <button class="btn btn-secondary" style="width: 100%; margin-top: 20px;" onclick="logout()">è¿”å›ç™»å½•</button>
            </div>
        </div>

        <!-- ä¸»é¡µé¢ -->
        <div id="mainPage" class="main-page">
            <!-- é€‰é¡¹å¡å¯¼èˆª -->
            <div style="padding: 0 24px; padding-top: 20px;">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('dashboard')">ğŸ“Š ä»ªè¡¨æ¿</button>
                    <button class="tab-btn" onclick="switchTab('add-project')">â• æ·»åŠ æ–°é¡¹ç›®</button>
                    <button class="tab-btn" onclick="switchTab('projects')">ğŸ“‹ æˆ‘çš„é¡¹ç›®</button>
                    <button class="tab-btn" id="leaderTab" style="display: none;" onclick="switchTab('leader')">ğŸ‘¥ éƒ¨é—¨ç»Ÿè®¡</button>
                    <button class="tab-btn" id="adminTab" style="display: none;" onclick="switchTab('admin')">ğŸ”§ ç®¡ç†å‘˜</button>
                </div>
            </div>

            <!-- ä»ªè¡¨æ¿ -->
            <div id="dashboard" class="dashboard active">
                <div class="content">
                    <!-- ä¸ªäººå±•æ¿ -->
                    <div id="userDashboard" style="display: none;">
                        <h2 style="margin-bottom: 20px;">ğŸ“ˆ ä¸ªäººä»ªè¡¨æ¿</h2>
                        
                        <div class="filter-row">
                            <div class="filter-group">
                                <label>å¼€å§‹æ—¥æœŸ</label>
                                <input type="date" id="filterStartDate">
                            </div>
                            <div class="filter-group">
                                <label>ç»“æŸæ—¥æœŸ</label>
                                <input type="date" id="filterEndDate">
                            </div>
                            <div class="filter-group">
                                <label>é¡¹ç›®ç±»å‹</label>
                                <select id="filterProjectType">
                                    <option value="">å…¨éƒ¨</option>
                                    <option value="presales">å”®å‰</option>
                                    <option value="aftersales">å”®å</option>
                                </select>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary btn-sm" onclick="applyFilters()">ğŸ” åº”ç”¨ç­›é€‰</button>
                            <button class="btn btn-secondary btn-sm" onclick="resetFilters()">â†º é‡ç½®</button>
                            <button class="btn btn-primary btn-sm" onclick="exportToExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
                        </div>

                        <div class="dashboard-section">
                            <h3>ä¸ªäººå·¥ä½œç»Ÿè®¡</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-label">å”®å‰å·²ç­¾å•</div>
                                    <div class="stat-value" id="userSignedAmount">Â£0.0K</div>
                                    <div class="stat-sub"><span id="userSignedCount">0</span>ä¸ªé¡¹ç›®</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">å”®å‰Pipeline</div>
                                    <div class="stat-value" id="userPipelineAmount">Â£0.0K</div>
                                    <div class="stat-sub"><span id="userPipelineCount">0</span>ä¸ª</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">å”®åé¡¹ç›®</div>
                                    <div class="stat-value" id="userAftersalesAmount">Â£0.0K</div>
                                    <div class="stat-sub"><span id="userAftersalesCount">0</span>ä¸ª</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">æ€»é¡¹ç›®é‡‘é¢</div>
                                    <div class="stat-value" id="userTotalAmount">Â£0.0K</div>
                                    <div class="stat-sub"><span id="userTotalCount">0</span>ä¸ª</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">å·¥ä½œæ—¶é•¿</div>
                                    <div class="stat-value" id="userWorkHours">0.0h</div>
                                    <div class="stat-sub">çº¦<span id="userWorkDays">0</span>å¤©</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">åŠ ç­æ—¶é•¿</div>
                                    <div class="stat-value" id="userOvertimeHours">0.0h</div>
                                    <div class="stat-sub">çº¦<span id="userOvertimeDays">0</span>å¤©</div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-section">
                            <h3>é¡¹ç›®åˆ†å¸ƒ</h3>
                            <div class="summary-grid" id="userProjectGrid"></div>
                        </div>
                    </div>

                    <!-- éƒ¨é—¨é¢†å¯¼å±•æ¿ -->
                    <div id="leaderDashboard" style="display: none;">
                        <h2 style="margin-bottom: 20px;">ğŸ‘¥ éƒ¨é—¨ä»ªè¡¨æ¿ - <span id="leaderDeptName"></span></h2>
                        
                        <div class="filter-row">
                            <div class="filter-group">
                                <label>å¼€å§‹æ—¥æœŸ</label>
                                <input type="date" id="leaderFilterStartDate">
                            </div>
                            <div class="filter-group">
                                <label>ç»“æŸæ—¥æœŸ</label>
                                <input type="date" id="leaderFilterEndDate">
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary btn-sm" onclick="applyLeaderFilters()">ğŸ” åº”ç”¨ç­›é€‰</button>
                            <button class="btn btn-secondary btn-sm" onclick="resetLeaderFilters()">â†º é‡ç½®</button>
                            <button class="btn btn-primary btn-sm" onclick="exportLeaderToExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
                        </div>

                        <div class="dashboard-section">
                            <h3>éƒ¨é—¨æ ¸å¿ƒæŒ‡æ ‡</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-label">éƒ¨é—¨æ€»é‡‘é¢</div>
                                    <div class="stat-value" id="leaderTotalAmount">Â£0.0K</div>
                                    <div class="stat-sub"><span id="leaderTotalProjects">0</span>ä¸ªé¡¹ç›®</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">éƒ¨é—¨æˆå‘˜æ•°</div>
                                    <div class="stat-value" id="leaderMemberCount">0</div>
                                    <div class="stat-sub">åæˆå‘˜</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">æ€»å·¥ä½œæ—¶é•¿</div>
                                    <div class="stat-value" id="leaderWorkHours">0.0h</div>
                                    <div class="stat-sub">çº¦<span id="leaderWorkDays">0</span>å¤©</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">æ€»åŠ ç­æ—¶é•¿</div>
                                    <div class="stat-value" id="leaderOvertimeHours">0.0h</div>
                                    <div class="stat-sub">çº¦<span id="leaderOvertimeDays">0</span>å¤©</div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-section">
                            <h3>æˆå‘˜å·¥ä½œç»Ÿè®¡</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>æˆå‘˜å§“å</th>
                                        <th>ä¸“ä¸šæ–¹å‘</th>
                                        <th>é¡¹ç›®æ•°</th>
                                        <th>æ€»è§„æ¨¡(Â£K)</th>
                                        <th>å·¥ä½œæ—¶é•¿(h)</th>
                                        <th>åŠ ç­æ—¶é•¿(h)</th>
                                    </tr>
                                </thead>
                                <tbody id="leaderMembersTableBody">
                                    <tr><td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">æš‚æ— æ•°æ®</td></tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="dashboard-section">
                            <h3>é¡¹ç›®åˆ†å¸ƒ</h3>
                            <div class="summary-grid" id="leaderProjectGrid"></div>
                        </div>
                    </div>

                    <!-- ç®¡ç†å‘˜å±•æ¿ -->
                    <div id="adminDashboard" style="display: none;">
                        <h2 style="margin-bottom: 20px;">ğŸ”§ ç®¡ç†å‘˜ä»ªè¡¨æ¿ - å…¨ä¼ä¸šæ•°æ®</h2>
                        
                        <div class="filter-row">
                            <div class="filter-group">
                                <label>å¼€å§‹æ—¥æœŸ</label>
                                <input type="date" id="adminFilterStartDate">
                            </div>
                            <div class="filter-group">
                                <label>ç»“æŸæ—¥æœŸ</label>
                                <input type="date" id="adminFilterEndDate">
                            </div>
                            <div class="filter-group">
                                <label>éƒ¨é—¨</label>
                                <select id="adminFilterDept">
                                    <option value="">å…¨éƒ¨éƒ¨é—¨</option>
                                </select>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary btn-sm" onclick="applyAdminFilters()">ğŸ” åº”ç”¨ç­›é€‰</button>
                            <button class="btn btn-secondary btn-sm" onclick="resetAdminFilters()">â†º é‡ç½®</button>
                            <button class="btn btn-primary btn-sm" onclick="exportAdminToExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
                        </div>

                        <div class="dashboard-section">
                            <h3>ä¼ä¸šæ ¸å¿ƒæŒ‡æ ‡</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-label">ä¼ä¸šæ€»é‡‘é¢</div>
                                    <div class="stat-value" id="adminTotalAmount">Â£0.0K</div>
                                    <div class="stat-sub"><span id="adminTotalProjects">0</span>ä¸ªé¡¹ç›®</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">æ€»éƒ¨é—¨æ•°</div>
                                    <div class="stat-value" id="adminDeptCount">0</div>
                                    <div class="stat-sub">ä¸ªéƒ¨é—¨</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">æ€»äººå‘˜æ•°</div>
                                    <div class="stat-value" id="adminUserCount">0</div>
                                    <div class="stat-sub">åå‘˜å·¥</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">ä¼ä¸šæ€»å·¥ä½œæ—¶é•¿</div>
                                    <div class="stat-value" id="adminWorkHours">0.0h</div>
                                    <div class="stat-sub">çº¦<span id="adminWorkDays">0</span>å¤©</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">ä¼ä¸šæ€»åŠ ç­æ—¶é•¿</div>
                                    <div class="stat-value" id="adminOvertimeHours">0.0h</div>
                                    <div class="stat-sub">çº¦<span id="adminOvertimeDays">0</span>å¤©</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">å¹³å‡é¡¹ç›®è§„æ¨¡</div>
                                    <div class="stat-value" id="adminAvgProjectSize">Â£0.0K</div>
                                    <div class="stat-sub">å¹³å‡</div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-section">
                            <h3>éƒ¨é—¨ç»Ÿè®¡</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>éƒ¨é—¨åç§°</th>
                                        <th>äººå‘˜æ•°</th>
                                        <th>é¡¹ç›®æ•°</th>
                                        <th>æ€»è§„æ¨¡(Â£K)</th>
                                        <th>å·¥ä½œæ—¶é•¿(h)</th>
                                        <th>åŠ ç­æ—¶é•¿(h)</th>
                                    </tr>
                                </thead>
                                <tbody id="adminDeptsTableBody">
                                    <tr><td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">æš‚æ— æ•°æ®</td></tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="dashboard-section">
                            <h3>å…¨å‘˜å·¥ä½œç»Ÿè®¡</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>å‘˜å·¥å§“å</th>
                                        <th>éƒ¨é—¨</th>
                                        <th>ä¸“ä¸šæ–¹å‘</th>
                                        <th>é¡¹ç›®æ•°</th>
                                        <th>æ€»è§„æ¨¡(Â£K)</th>
                                        <th>å·¥ä½œæ—¶é•¿(h)</th>
                                        <th>åŠ ç­æ—¶é•¿(h)</th>
                                    </tr>
                                </thead>
                                <tbody id="adminUsersTableBody">
                                    <tr><td colspan="7" style="text-align: center; padding: 40px; color: #9ca3af;">æš‚æ— æ•°æ®</td></tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="dashboard-section">
                            <h3>é¡¹ç›®ç±»å‹åˆ†å¸ƒ</h3>
                            <div class="summary-grid" id="adminProjectTypeGrid"></div>
                        </div>

                        <div class="dashboard-section">
                            <h3>è¡Œä¸šåˆ†å¸ƒ</h3>
                            <div class="summary-grid" id="adminIndustryGrid"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ·»åŠ é¡¹ç›® -->
            <div id="add-project" class="form-section">
                <div class="content">
                    <h2 style="margin-bottom: 20px;">æ·»åŠ æ–°é¡¹ç›®</h2>
                    <form id="projectForm" onsubmit="saveProject(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>å‘¨èµ·å§‹æ—¥æœŸ *</label>
                                <input type="date" id="weekStartDate" required>
                            </div>
                            <div class="form-group">
                                <label>å®¢æˆ·åç§° *</label>
                                <input type="text" id="clientName" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>é¡¹ç›®åç§° *</label>
                                <input type="text" id="projectName" required>
                            </div>
                            <div class="form-group">
                                <label>è¡Œä¸š *</label>
                                <input type="text" id="industry" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>é¡¹ç›®è§„æ¨¡ (Â£K) *</label>
                                <input type="number" id="projectScale" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label>é¡¹ç›®ç±»å‹ *</label>
                                <select id="projectType" required>
                                    <option value="">-- è¯·é€‰æ‹© --</option>
                                    <option value="presales">å”®å‰</option>
                                    <option value="aftersales">å”®å</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>ä¸“ä¸šæ–¹å‘ *</label>
                                <select id="specialty" required>
                                    <option value="">-- è¯·é€‰æ‹© --</option>
                                    <option value="ç½‘ç»œ">ç½‘ç»œ</option>
                                    <option value="ç³»ç»Ÿ">ç³»ç»Ÿ</option>
                                    <option value="åŸºç¡€è®¾æ–½">åŸºç¡€è®¾æ–½</option>
                                </select>
                            </div>
                            <div id="signedStatusGroup" class="form-group">
                                <label>ç­¾å•çŠ¶æ€ *</label>
                                <select id="signedStatus">
                                    <option value="signed">å·²ç­¾å•</option>
                                    <option value="pipeline">Pipeline</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-buttons">
                            <button type="button" class="btn btn-secondary" onclick="resetForm()">é‡ç½®</button>
                            <button type="submit" class="btn btn-primary">ä¿å­˜é¡¹ç›®</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- æˆ‘çš„é¡¹ç›® -->
            <div id="projects" class="form-section">
                <div class="content">
                    <h2 style="margin-bottom: 20px;">æˆ‘çš„é¡¹ç›®</h2>
                    
                    <div class="controls">
                        <button class="btn btn-primary" onclick="switchTab('add-project')">+ æ·»åŠ é¡¹ç›®</button>
                        <div style="font-size: 13px; color: #6b7280;">å…± <span id="projectListCount">0</span> ä¸ªé¡¹ç›®</div>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>å®¢æˆ·</th>
                                <th>é¡¹ç›®</th>
                                <th>è¡Œä¸š</th>
                                <th>è§„æ¨¡ (Â£K)</th>
                                <th>ç±»å‹</th>
                                <th>ä¸“ä¸šæ–¹å‘</th>
                                <th>å·¥ä½œæ—¶é•¿</th>
                                <th>åŠ ç­æ—¶é•¿</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="projectsTableBody">
                            <tr><td colspan="9" style="text-align: center; padding: 40px; color: #9ca3af;">æš‚æ— é¡¹ç›®</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- éƒ¨é—¨é¢†å¯¼é¡µé¢ -->
            <div id="leader" class="form-section">
                <div class="content">
                    <h2 style="margin-bottom: 20px;">éƒ¨é—¨ç®¡ç†</h2>
                    <p style="color: #6b7280; margin-bottom: 20px;">åœ¨ä»ªè¡¨æ¿ä¸­æŸ¥çœ‹éƒ¨é—¨ç»Ÿè®¡æ•°æ®</p>
                    <button class="btn btn-primary" onclick="switchTab('dashboard')">ğŸ“Š æŸ¥çœ‹éƒ¨é—¨ä»ªè¡¨æ¿</button>
                </div>
            </div>

            <!-- ç®¡ç†å‘˜é¡µé¢ -->
            <div id="admin" class="form-section">
                <div class="content">
                    <h2 style="margin-bottom: 20px;">ç®¡ç†å‘˜æ§åˆ¶é¢æ¿</h2>
                    
                    <!-- å¾…å®¡æ‰¹ç”¨æˆ· -->
                    <div class="dashboard-section">
                        <h3>å¾…å®¡æ‰¹ç”¨æˆ· (<span id="pendingUserCount">0</span>)</h3>
                        <div id="pendingUsersContainer">
                            <p style="color: #9ca3af; padding: 20px; text-align: center;">æš‚æ— å¾…å®¡æ‰¹ç”¨æˆ·</p>
                        </div>
                    </div>
                    
                    <!-- å·²æ¿€æ´»ç”¨æˆ· -->
                    <div class="dashboard-section">
                        <h3>ç”¨æˆ·ç®¡ç† (<span id="activeUserCount">0</span>)</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>å§“å</th>
                                    <th>é‚®ç®±</th>
                                    <th>éƒ¨é—¨</th>
                                    <th>ä¸“ä¸šæ–¹å‘</th>
                                    <th>è§’è‰²</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="activeUsersTableBody">
                                <tr><td colspan="7" style="text-align: center; padding: 40px; color: #9ca3af;">æš‚æ— ç”¨æˆ·</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·ä¿¡æ¯è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="userProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">âš™ï¸ ä¸ªäººä¿¡æ¯è®¾ç½®</div>
            <form id="userProfileForm" onsubmit="saveUserProfile(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>å§“å *</label>
                        <input type="text" id="profileName" required>
                    </div>
                    <div class="form-group">
                        <label>é‚®ç®± *</label>
                        <input type="email" id="profileEmail" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>éƒ¨é—¨ *</label>
                        <input type="text" id="profileDept" placeholder="ä¾‹å¦‚ï¼šæŠ€æœ¯éƒ¨ã€é”€å”®éƒ¨" required>
                    </div>
                    <div class="form-group">
                        <label>ä¸“ä¸šæ–¹å‘ *</label>
                        <select id="profileSpecialty" required>
                            <option value="">-- è¯·é€‰æ‹© --</option>
                            <option value="ç½‘ç»œ">ç½‘ç»œ</option>
                            <option value="ç³»ç»Ÿ">ç³»ç»Ÿ</option>
                            <option value="åŸºç¡€è®¾æ–½">åŸºç¡€è®¾æ–½</option>
                        </select>
                    </div>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeUserProfileModal()">å…³é—­</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ä¿å­˜å¹¶æäº¤å®¡æ‰¹</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDmSEQFZVNk8DJL5rW0CQzLmPGQ5pXZRak",
            authDomain: "weekly-report-d55e9.firebaseapp.com",
            projectId: "weekly-report-d55e9",
            storageBucket: "weekly-report-d55e9.appspot.com",
            messagingSenderId: "1018033981926",
            appId: "1:1018033981926:web:e1b2c3d4e5f6a7b8c9d0e1"
        };

        // ç®¡ç†å‘˜é‚®ç®±ç™½åå• - è¿™äº›é‚®ç®±ç›´æ¥è·å¾—ç®¡ç†å‘˜æƒé™ï¼Œæ— éœ€å®¡æ‰¹
        const ADMIN_EMAILS = [
            'liuxinyu0914@gmail.com'
        ];

        let firebase_app = null;
        let db = null;
        let currentUser = null;
        let currentUserProfile = null;
        let projects = [];
        let filteredProjects = [];
        let allUsers = [];

        async function initFirebase() {
            try {
                console.log('=== å¼€å§‹åˆå§‹åŒ–Firebase ===');
                
                // ç¬¬0æ­¥ï¼šç­‰å¾…firebaseåº“åŠ è½½
                console.log('0. ç­‰å¾…Firebaseåº“åŠ è½½...');
                let firebaseAttempts = 0;
                while (typeof firebase === 'undefined' && firebaseAttempts < 20) {
                    console.log('   Firebaseåº“å°šæœªåŠ è½½ï¼Œç­‰å¾…ä¸­... (#' + firebaseAttempts + ')');
                    await new Promise(resolve => setTimeout(resolve, 500));
                    firebaseAttempts++;
                }
                
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebaseåº“åŠ è½½å¤±è´¥ï¼šç»è¿‡10ç§’ç­‰å¾…ä»æœªåŠ è½½');
                }
                console.log('   Firebaseåº“åŠ è½½æˆåŠŸ âœ“');
                
                // ç¬¬1æ­¥ï¼šæ£€æŸ¥firebaseå¯¹è±¡
                console.log('1. æ£€æŸ¥firebaseå¯¹è±¡...');
                console.log('   typeof firebase:', typeof firebase);
                console.log('   firebase.initializeApp:', typeof firebase.initializeApp);
                
                if (typeof firebase.initializeApp !== 'function') {
                    throw new Error('firebase.initializeAppä¸æ˜¯å‡½æ•°');
                }
                
                if (firebase_app) {
                    console.log('   Firebaseå·²åˆå§‹åŒ–ï¼Œä½¿ç”¨ç°æœ‰å®ä¾‹');
                    return true;
                }
                
                console.log('2. åˆå§‹åŒ–Firebase App...');
                console.log('   firebaseConfig:', firebaseConfig);
                firebase_app = firebase.initializeApp(firebaseConfig);
                console.log('   firebase_appåˆå§‹åŒ–æˆåŠŸ:', firebase_app.name);
                
                console.log('3. ç­‰å¾…Firestoreåº“åŠ è½½...');
                let firestoreAttempts = 0;
                while (typeof firebase.firestore !== 'function' && firestoreAttempts < 20) {
                    console.log('   Firestoreåº“å°šæœªåŠ è½½ï¼Œç­‰å¾…ä¸­... (#' + firestoreAttempts + ')');
                    await new Promise(resolve => setTimeout(resolve, 500));
                    firestoreAttempts++;
                }
                
                if (typeof firebase.firestore !== 'function') {
                    throw new Error('Firestoreåº“åŠ è½½å¤±è´¥');
                }
                
                console.log('4. åˆå§‹åŒ–Firestore...');
                db = firebase.firestore(firebase_app);
                console.log('   dbåˆå§‹åŒ–æˆåŠŸ:', typeof db);
                
                console.log('5. æµ‹è¯•Firestoreè¿æ¥...');
                if (typeof db.collection !== 'function') {
                    throw new Error('db.collectionä¸æ˜¯å‡½æ•°');
                }
                console.log('   db.collectionæ–¹æ³•å­˜åœ¨ âœ“');
                
                console.log('=== Firebaseåˆå§‹åŒ–å®Œæˆ ===');
                return true;
            } catch (error) {
                console.error('âŒ Firebaseåˆå§‹åŒ–å¤±è´¥:');
                console.error('   é”™è¯¯ä¿¡æ¯:', error.message);
                console.error('   é”™è¯¯å †æ ˆ:', error.stack);
                console.error('   firebaseå¯¹è±¡:', typeof firebase);
                console.error('   firebaseConfig:', firebaseConfig);
                return false;
            }
        }

        window.addEventListener('load', async () => {
            const today = new Date();
            document.getElementById('weekStartDate').valueAsDate = today;
            
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            document.getElementById('filterStartDate').valueAsDate = startOfWeek;
            document.getElementById('filterEndDate').valueAsDate = endOfWeek;
            document.getElementById('leaderFilterStartDate').valueAsDate = startOfWeek;
            document.getElementById('leaderFilterEndDate').valueAsDate = endOfWeek;
            document.getElementById('adminFilterStartDate').valueAsDate = startOfWeek;
            document.getElementById('adminFilterEndDate').valueAsDate = endOfWeek;
            
            await initFirebase();
        });

        async function signInWithGoogle() {
            try {
                if (typeof google === 'undefined') {
                    setTimeout(signInWithGoogle, 1000);
                    return;
                }

                google.accounts.id.initialize({
                    client_id: '1018033981926-cg6bl58ehp3kpm0rlcr7vlgeg8iore3g.apps.googleusercontent.com',
                    callback: handleCredentialResponse,
                    auto_select: false
                });

                google.accounts.id.prompt();

            } catch (e) {
                alert('ç™»å½•å¤±è´¥: ' + e.message);
            }
        }

        async function handleCredentialResponse(response) {
            try {
                console.log('=== å¤„ç†Googleç™»å½•å“åº” ===');
                
                // ç¬¬1æ­¥ï¼šç¡®ä¿Firebaseå·²åˆå§‹åŒ–
                console.log('1. æ£€æŸ¥Firebaseåˆå§‹åŒ–çŠ¶æ€...');
                if (!db) {
                    console.log('   dbæœªåˆå§‹åŒ–ï¼Œè¿›è¡Œåˆå§‹åŒ–...');
                    const initResult = await initFirebase();
                    if (!initResult) {
                        alert('Firebaseåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                        return;
                    }
                }
                console.log('   Firebaseå·²å°±ç»ª âœ“');
                
                // ç¬¬2æ­¥ï¼šè§£æJWTä»¤ç‰Œ
                console.log('2. è§£æGoogle JWTä»¤ç‰Œ...');
                const decoded = jwt_decode(response.credential);
                currentUser = {
                    email: decoded.email,
                    name: decoded.name,
                    picture: decoded.picture
                };
                console.log('   ç”¨æˆ·ä¿¡æ¯:', currentUser);
                
                // ç¬¬3æ­¥ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜
                console.log('3. æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜...');
                const isAdmin = ADMIN_EMAILS.includes(currentUser.email);
                console.log('   æ˜¯å¦ç®¡ç†å‘˜:', isAdmin ? 'âœ“ æ˜¯' : 'âœ— å¦');
                
                // ç¬¬4æ­¥ï¼šæŸ¥è¯¢Firestore
                console.log('4. ä»FirestoreæŸ¥è¯¢ç”¨æˆ·...');
                const userRef = db.collection('users').doc(currentUser.email);
                const userDoc = await userRef.get();
                
                if (userDoc.exists) {
                    console.log('   æ‰¾åˆ°ç”¨æˆ·èµ„æ–™');
                    currentUserProfile = userDoc.data();
                    console.log('   åŸå§‹çŠ¶æ€:', currentUserProfile.status, 'è§’è‰²:', currentUserProfile.role);
                    
                    // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œç¡®ä¿statuså’Œroleæ­£ç¡®
                    if (isAdmin) {
                        console.log('   æ£€æµ‹åˆ°ç®¡ç†å‘˜è´¦æˆ·...');
                        if (currentUserProfile.status !== 'active' || currentUserProfile.role !== 'admin') {
                            console.log('   æƒé™ä¸æ­£ç¡®ï¼Œè‡ªåŠ¨æ¿€æ´»å¹¶è®¾ç½®æƒé™...');
                            await userRef.update({ 
                                status: 'active', 
                                role: 'admin',
                                lastUpdated: new Date().toISOString()
                            });
                            console.log('   âœ“ æ•°æ®åº“å·²æ›´æ–°');
                        }
                        // å¼ºåˆ¶è®¾ç½®ä¸ºactiveå’Œadminï¼Œç¡®ä¿åç»­åˆ¤æ–­æ­£ç¡®
                        currentUserProfile.status = 'active';
                        currentUserProfile.role = 'admin';
                        console.log('   âœ“ ç®¡ç†å‘˜æƒé™å·²ç¡®è®¤ï¼Œå‡†å¤‡æ˜¾ç¤ºä¸»é¡µé¢');
                    }
                    
                    // æ˜¾ç¤ºç›¸åº”é¡µé¢
                    console.log('5. æ ¹æ®çŠ¶æ€æ˜¾ç¤ºé¡µé¢...');
                    console.log('   å½“å‰çŠ¶æ€: ' + currentUserProfile.status);
                    
                    if (currentUserProfile.status === 'active') {
                        console.log('   âœ“ çŠ¶æ€ä¸ºactiveï¼Œæ˜¾ç¤ºä¸»é¡µé¢');
                        showMainPage();
                        loadAllData();
                    } else if (currentUserProfile.status === 'pending') {
                        console.log('   â³ çŠ¶æ€ä¸ºpendingï¼Œæ˜¾ç¤ºå®¡æ‰¹é¡µé¢');
                        showPendingPage();
                    } else {
                        console.log('   âš ï¸ æœªçŸ¥çŠ¶æ€: ' + currentUserProfile.status);
                    }
                } else {
                    console.log('   ç”¨æˆ·æœªæ³¨å†Œï¼Œæ˜¾ç¤ºä¸ªäººä¿¡æ¯è®¾ç½®é¡µé¢');
                    document.getElementById('profileEmail').value = currentUser.email;
                    openUserProfileModal();
                }
                
                console.log('=== ç™»å½•å¤„ç†å®Œæˆ ===');
            } catch(e) {
                console.error('âŒ å¤„ç†ç™»å½•å¤±è´¥:');
                console.error('   é”™è¯¯ä¿¡æ¯:', e.message);
                console.error('   é”™è¯¯å †æ ˆ:', e.stack);
                console.error('   dbå¯¹è±¡çŠ¶æ€:', db);
                alert('è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼š' + e.message);
            }
        }

        async function saveUserProfile(e) {
            e.preventDefault();
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜
            const isAdmin = ADMIN_EMAILS.includes(currentUser.email);
            console.log('ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œæ˜¯å¦ç®¡ç†å‘˜:', isAdmin ? 'âœ“ æ˜¯' : 'âœ— å¦');
            
            const profileData = {
                name: document.getElementById('profileName').value,
                email: document.getElementById('profileEmail').value,
                department: document.getElementById('profileDept').value,
                specialty: document.getElementById('profileSpecialty').value,
                status: isAdmin ? 'active' : 'pending',  // ç®¡ç†å‘˜ç›´æ¥activeï¼Œå…¶ä»–pending
                role: isAdmin ? 'admin' : 'user',         // ç®¡ç†å‘˜roleè®¾ä¸ºadminï¼Œå…¶ä»–ä¸ºuser
                createdAt: new Date().toISOString(),
                googleName: currentUser.name,
                googleEmail: currentUser.email
            };
            
            try {
                console.log('ä¿å­˜ç”¨æˆ·æ•°æ®:', profileData);
                await db.collection('users').doc(currentUser.email).set(profileData);
                currentUserProfile = profileData;
                closeUserProfileModal();
                
                if (isAdmin) {
                    console.log('âœ“ ç®¡ç†å‘˜è´¦æˆ·å·²æ¿€æ´»');
                    alert('âœ… æ¬¢è¿ï¼ä½ å·²ä»¥ç®¡ç†å‘˜èº«ä»½è¿›å…¥ç³»ç»Ÿ');
                    showMainPage();
                    loadAllData();
                } else {
                    console.log('æ™®é€šç”¨æˆ·ï¼Œç­‰å¾…å®¡æ‰¹');
                    showPendingPage();
                    alert('âœ… ä¿¡æ¯å·²ä¿å­˜ï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ‰¹');
                }
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        function showPendingPage() {
            console.log('æ˜¾ç¤ºå®¡æ‰¹é¡µé¢...');
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('pendingPage').style.display = 'flex';
            
            if (currentUserProfile) {
                document.getElementById('pendingName').textContent = currentUserProfile.name;
                document.getElementById('pendingEmail').textContent = currentUserProfile.email;
                document.getElementById('pendingDept').textContent = currentUserProfile.department;
                document.getElementById('pendingSpecialty').textContent = currentUserProfile.specialty;
            }
            console.log('å®¡æ‰¹é¡µé¢æ˜¾ç¤ºå®Œæˆ âœ“');
        }

        function showMainPage() {
            console.log('æ˜¾ç¤ºä¸»é¡µé¢...');
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('pendingPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';  // æ”¹ä¸ºdisplay='block'
            document.getElementById('mainPage').classList.add('active');
            document.getElementById('userSection').style.display = 'flex';
            
            const name = currentUserProfile?.name || currentUser.name || currentUser.email;
            document.getElementById('userName').textContent = name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').textContent = name.charAt(0).toUpperCase();
            
            const roleBadge = document.getElementById('roleBadge');
            roleBadge.textContent = currentUserProfile?.role === 'admin' ? 'ç®¡ç†å‘˜' : (currentUserProfile?.role === 'leader' ? 'éƒ¨é—¨é¢†å¯¼' : 'ç”¨æˆ·');
            roleBadge.classList.remove('user', 'leader', 'admin');
            if (currentUserProfile?.role === 'admin') {
                roleBadge.classList.add('admin');
                document.getElementById('adminTab').style.display = 'block';
                document.getElementById('leaderTab').style.display = 'block';
            } else if (currentUserProfile?.role === 'leader') {
                roleBadge.classList.add('leader');
                document.getElementById('leaderTab').style.display = 'block';
            } else {
                roleBadge.classList.add('user');
            }
            console.log('ä¸»é¡µé¢æ˜¾ç¤ºå®Œæˆ âœ“');
        }

        async function loadAllData() {
            loadProjects();
            
            if (currentUserProfile?.role === 'leader' || currentUserProfile?.role === 'admin') {
                loadAllUsers();
            }
            
            updateDashboardDisplay();
        }

        function loadProjects() {
            const saved = localStorage.getItem('projects_' + currentUser.email);
            projects = saved ? JSON.parse(saved) : [];
            filteredProjects = projects;
            renderProjectsList();
            updateUserDashboard();
        }

        async function loadAllUsers() {
            try {
                const usersSnapshot = await db.collection('users').where('status', '==', 'active').get();
                allUsers = [];
                usersSnapshot.forEach(doc => {
                    allUsers.push(doc.data());
                });
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·å¤±è´¥:', error);
            }
        }

        function updateDashboardDisplay() {
            document.getElementById('userDashboard').style.display = 'none';
            document.getElementById('leaderDashboard').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'none';
            
            if (currentUserProfile?.role === 'admin') {
                document.getElementById('adminDashboard').style.display = 'block';
                updateAdminDashboard();
            } else if (currentUserProfile?.role === 'leader') {
                document.getElementById('leaderDashboard').style.display = 'block';
                updateLeaderDashboard();
            } else {
                document.getElementById('userDashboard').style.display = 'block';
                updateUserDashboard();
            }
        }

        function updateUserDashboard() {
            const presalesSigned = filteredProjects.filter(p => p.projectType === 'presales' && p.signedStatus === 'signed');
            const presalesPipeline = filteredProjects.filter(p => p.projectType === 'presales' && p.signedStatus === 'pipeline');
            const aftersales = filteredProjects.filter(p => p.projectType === 'aftersales');
            
            const signedAmount = presalesSigned.reduce((sum, p) => sum + parseFloat(p.projectScale || 0), 0);
            const pipelineAmount = presalesPipeline.reduce((sum, p) => sum + parseFloat(p.projectScale || 0), 0);
            const aftersalesAmount = aftersales.reduce((sum, p) => sum + parseFloat(p.projectScale || 0), 0);
            const totalAmount = signedAmount + pipelineAmount + aftersalesAmount;
            
            let totalWorkHours = 0, totalOvertimeHours = 0;
            filteredProjects.forEach(p => {
                if (p.workLogs) {
                    p.workLogs.forEach(log => {
                        const hours = parseFloat(log.hours || 0);
                        if (log.type === 'overtime') {
                            totalOvertimeHours += hours;
                        } else {
                            totalWorkHours += hours;
                        }
                    });
                }
            });
            
            document.getElementById('userSignedAmount').textContent = 'Â£' + signedAmount.toFixed(1) + 'K';
            document.getElementById('userSignedCount').textContent = presalesSigned.length;
            document.getElementById('userPipelineAmount').textContent = 'Â£' + pipelineAmount.toFixed(1) + 'K';
            document.getElementById('userPipelineCount').textContent = presalesPipeline.length;
            document.getElementById('userAftersalesAmount').textContent = 'Â£' + aftersalesAmount.toFixed(1) + 'K';
            document.getElementById('userAftersalesCount').textContent = aftersales.length;
            document.getElementById('userTotalAmount').textContent = 'Â£' + totalAmount.toFixed(1) + 'K';
            document.getElementById('userTotalCount').textContent = filteredProjects.length;
            document.getElementById('userWorkHours').textContent = totalWorkHours.toFixed(1) + 'h';
            document.getElementById('userWorkDays').textContent = Math.round(totalWorkHours / 8);
            document.getElementById('userOvertimeHours').textContent = totalOvertimeHours.toFixed(1) + 'h';
            document.getElementById('userOvertimeDays').textContent = Math.round(totalOvertimeHours / 8);
            
            const industryMap = {};
            filteredProjects.forEach(p => {
                if (!industryMap[p.industry]) industryMap[p.industry] = 0;
                industryMap[p.industry] += parseFloat(p.projectScale || 0);
            });
            
            let industryHTML = '';
            Object.entries(industryMap).forEach(([industry, amount]) => {
                industryHTML += `<div class="summary-card"><strong>${industry}</strong><div class="amount">Â£${amount.toFixed(1)}K</div></div>`;
            });
            document.getElementById('userProjectGrid').innerHTML = industryHTML || '<p style="color: #9ca3af;">æš‚æ— æ•°æ®</p>';
        }

        async function updateLeaderDashboard() {
            document.getElementById('leaderDeptName').textContent = currentUserProfile.department;
            
            const usersSnapshot = await db.collection('users')
                .where('department', '==', currentUserProfile.department)
                .where('status', '==', 'active')
                .get();
            
            const deptUsers = [];
            usersSnapshot.forEach(doc => {
                deptUsers.push(doc.data());
            });
            
            let totalAmount = 0, totalWorkHours = 0, totalOvertimeHours = 0, totalProjects = 0;
            const memberStats = {};
            
            for (const user of deptUsers) {
                const saved = localStorage.getItem('projects_' + user.email);
                const userProjects = saved ? JSON.parse(saved) : [];
                
                totalProjects += userProjects.length;
                
                let userWorkHours = 0, userOvertimeHours = 0, userTotal = 0;
                userProjects.forEach(p => {
                    userTotal += parseFloat(p.projectScale || 0);
                    if (p.workLogs) {
                        p.workLogs.forEach(log => {
                            const hours = parseFloat(log.hours || 0);
                            if (log.type === 'overtime') {
                                userOvertimeHours += hours;
                            } else {
                                userWorkHours += hours;
                            }
                        });
                    }
                });
                
                totalAmount += userTotal;
                totalWorkHours += userWorkHours;
                totalOvertimeHours += userOvertimeHours;
                
                memberStats[user.email] = {
                    name: user.name,
                    specialty: user.specialty,
                    projectCount: userProjects.length,
                    totalScale: userTotal,
                    workHours: userWorkHours,
                    overtimeHours: userOvertimeHours
                };
            }
            
            document.getElementById('leaderTotalAmount').textContent = 'Â£' + totalAmount.toFixed(1) + 'K';
            document.getElementById('leaderTotalProjects').textContent = totalProjects;
            document.getElementById('leaderMemberCount').textContent = deptUsers.length;
            document.getElementById('leaderWorkHours').textContent = totalWorkHours.toFixed(1) + 'h';
            document.getElementById('leaderWorkDays').textContent = Math.round(totalWorkHours / 8);
            document.getElementById('leaderOvertimeHours').textContent = totalOvertimeHours.toFixed(1) + 'h';
            document.getElementById('leaderOvertimeDays').textContent = Math.round(totalOvertimeHours / 8);
            
            let tableHTML = '';
            Object.values(memberStats).forEach(stats => {
                tableHTML += `
                    <tr>
                        <td>${stats.name}</td>
                        <td><span class="badge badge-${stats.specialty === 'ç½‘ç»œ' ? 'network' : (stats.specialty === 'ç³»ç»Ÿ' ? 'system' : 'infra')}">${stats.specialty}</span></td>
                        <td>${stats.projectCount}</td>
                        <td>Â£${stats.totalScale.toFixed(1)}K</td>
                        <td>${stats.workHours.toFixed(1)}</td>
                        <td>${stats.overtimeHours.toFixed(1)}</td>
                    </tr>
                `;
            });
            
            document.getElementById('leaderMembersTableBody').innerHTML = tableHTML || '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">æš‚æ— æ•°æ®</td></tr>';
        }

        async function updateAdminDashboard() {
            try {
                const usersSnapshot = await db.collection('users').where('status', '==', 'active').get();
                
                let totalAmount = 0, totalWorkHours = 0, totalOvertimeHours = 0, totalProjects = 0;
                const deptMap = {}, userStats = [], industryMap = {}, projectTypeMap = {};
                const deptSelectEl = document.getElementById('adminFilterDept');
                const depts = new Set();
                
                // æ”¶é›†æ‰€æœ‰éƒ¨é—¨
                usersSnapshot.forEach(doc => {
                    depts.add(doc.data().department);
                });
                
                // æ›´æ–°éƒ¨é—¨ç­›é€‰ä¸‹æ‹‰èœå•
                deptSelectEl.innerHTML = '<option value="">å…¨éƒ¨éƒ¨é—¨</option>';
                depts.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    deptSelectEl.appendChild(option);
                });
                
                // ç»Ÿè®¡æ•°æ®
                const users = [];
                usersSnapshot.forEach(doc => {
                    users.push(doc.data());
                });
                
                for (const user of users) {
                    const saved = localStorage.getItem('projects_' + user.email);
                    const userProjects = saved ? JSON.parse(saved) : [];
                    
                    totalProjects += userProjects.length;
                    
                    let userWorkHours = 0, userOvertimeHours = 0, userTotal = 0;
                    userProjects.forEach(p => {
                        userTotal += parseFloat(p.projectScale || 0);
                        
                        if (!industryMap[p.industry]) industryMap[p.industry] = 0;
                        industryMap[p.industry] += parseFloat(p.projectScale || 0);
                        
                        if (!projectTypeMap[p.projectType]) projectTypeMap[p.projectType] = 0;
                        projectTypeMap[p.projectType] += parseFloat(p.projectScale || 0);
                        
                        if (p.workLogs) {
                            p.workLogs.forEach(log => {
                                const hours = parseFloat(log.hours || 0);
                                if (log.type === 'overtime') {
                                    userOvertimeHours += hours;
                                } else {
                                    userWorkHours += hours;
                                }
                            });
                        }
                    });
                    
                    totalAmount += userTotal;
                    totalWorkHours += userWorkHours;
                    totalOvertimeHours += userOvertimeHours;
                    
                    userStats.push({
                        name: user.name,
                        email: user.email,
                        department: user.department,
                        specialty: user.specialty,
                        projectCount: userProjects.length,
                        totalScale: userTotal,
                        workHours: userWorkHours,
                        overtimeHours: userOvertimeHours
                    });
                    
                    if (!deptMap[user.department]) {
                        deptMap[user.department] = {
                            userCount: 0,
                            projectCount: 0,
                            totalScale: 0,
                            workHours: 0,
                            overtimeHours: 0
                        };
                    }
                    
                    deptMap[user.department].userCount++;
                    deptMap[user.department].projectCount += userProjects.length;
                    deptMap[user.department].totalScale += userTotal;
                    deptMap[user.department].workHours += userWorkHours;
                    deptMap[user.department].overtimeHours += userOvertimeHours;
                }
                
                // æ›´æ–°æ ¸å¿ƒæŒ‡æ ‡
                document.getElementById('adminTotalAmount').textContent = 'Â£' + totalAmount.toFixed(1) + 'K';
                document.getElementById('adminTotalProjects').textContent = totalProjects;
                document.getElementById('adminDeptCount').textContent = depts.size;
                document.getElementById('adminUserCount').textContent = users.length;
                document.getElementById('adminWorkHours').textContent = totalWorkHours.toFixed(1) + 'h';
                document.getElementById('adminWorkDays').textContent = Math.round(totalWorkHours / 8);
                document.getElementById('adminOvertimeHours').textContent = totalOvertimeHours.toFixed(1) + 'h';
                document.getElementById('adminOvertimeDays').textContent = Math.round(totalOvertimeHours / 8);
                document.getElementById('adminAvgProjectSize').textContent = totalProjects > 0 ? 'Â£' + (totalAmount / totalProjects).toFixed(1) + 'K' : 'Â£0.0K';
                
                // éƒ¨é—¨ç»Ÿè®¡è¡¨æ ¼
                let deptTableHTML = '';
                Object.entries(deptMap).forEach(([dept, stats]) => {
                    deptTableHTML += `
                        <tr>
                            <td>${dept}</td>
                            <td>${stats.userCount}</td>
                            <td>${stats.projectCount}</td>
                            <td>Â£${stats.totalScale.toFixed(1)}K</td>
                            <td>${stats.workHours.toFixed(1)}</td>
                            <td>${stats.overtimeHours.toFixed(1)}</td>
                        </tr>
                    `;
                });
                document.getElementById('adminDeptsTableBody').innerHTML = deptTableHTML || '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">æš‚æ— æ•°æ®</td></tr>';
                
                // å…¨å‘˜ç»Ÿè®¡è¡¨æ ¼
                let userTableHTML = '';
                userStats.forEach(stats => {
                    userTableHTML += `
                        <tr>
                            <td>${stats.name}</td>
                            <td>${stats.department}</td>
                            <td><span class="badge badge-${stats.specialty === 'ç½‘ç»œ' ? 'network' : (stats.specialty === 'ç³»ç»Ÿ' ? 'system' : 'infra')}">${stats.specialty}</span></td>
                            <td>${stats.projectCount}</td>
                            <td>Â£${stats.totalScale.toFixed(1)}K</td>
                            <td>${stats.workHours.toFixed(1)}</td>
                            <td>${stats.overtimeHours.toFixed(1)}</td>
                        </tr>
                    `;
                });
                document.getElementById('adminUsersTableBody').innerHTML = userTableHTML || '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #9ca3af;">æš‚æ— æ•°æ®</td></tr>';
                
                // é¡¹ç›®ç±»å‹åˆ†å¸ƒ
                let typeHTML = '';
                Object.entries(projectTypeMap).forEach(([type, amount]) => {
                    const typeText = type === 'presales' ? 'å”®å‰' : 'å”®å';
                    typeHTML += `<div class="summary-card"><strong>${typeText}</strong><div class="amount">Â£${amount.toFixed(1)}K</div></div>`;
                });
                document.getElementById('adminProjectTypeGrid').innerHTML = typeHTML || '<p style="color: #9ca3af;">æš‚æ— æ•°æ®</p>';
                
                // è¡Œä¸šåˆ†å¸ƒ
                let industryHTML = '';
                Object.entries(industryMap).forEach(([industry, amount]) => {
                    industryHTML += `<div class="summary-card"><strong>${industry}</strong><div class="amount">Â£${amount.toFixed(1)}K</div></div>`;
                });
                document.getElementById('adminIndustryGrid').innerHTML = industryHTML || '<p style="color: #9ca3af;">æš‚æ— æ•°æ®</p>';
                
            } catch (error) {
                console.error('æ›´æ–°ç®¡ç†å‘˜ä»ªè¡¨æ¿å¤±è´¥:', error);
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.form-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.dashboard').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            if (tabName === 'dashboard') {
                document.getElementById('dashboard').classList.add('active');
                updateDashboardDisplay();
            } else if (tabName === 'add-project') {
                document.getElementById('add-project').classList.add('active');
            } else if (tabName === 'projects') {
                document.getElementById('projects').classList.add('active');
                renderProjectsList();
            } else if (tabName === 'leader') {
                document.getElementById('leader').classList.add('active');
            } else if (tabName === 'admin') {
                document.getElementById('admin').classList.add('active');
            }
            
            event.target.classList.add('active');
        }

        function applyFilters() {
            const startDate = document.getElementById('filterStartDate').value ? new Date(document.getElementById('filterStartDate').value) : null;
            const endDate = document.getElementById('filterEndDate').value ? new Date(document.getElementById('filterEndDate').value) : null;
            const projectType = document.getElementById('filterProjectType').value;
            
            filteredProjects = projects.filter(p => {
                const pDate = new Date(p.weekStartDate);
                if (startDate && pDate < startDate) return false;
                if (endDate && pDate > endDate) return false;
                if (projectType && p.projectType !== projectType) return false;
                return true;
            });
            
            updateUserDashboard();
            alert('ç­›é€‰å®Œæˆï¼');
        }

        function resetFilters() {
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            
            document.getElementById('filterStartDate').valueAsDate = startOfWeek;
            document.getElementById('filterEndDate').valueAsDate = today;
            document.getElementById('filterProjectType').value = '';
            
            filteredProjects = projects;
            updateUserDashboard();
        }

        function applyLeaderFilters() {
            updateLeaderDashboard();
            alert('ç­›é€‰å®Œæˆï¼');
        }

        function resetLeaderFilters() {
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            
            document.getElementById('leaderFilterStartDate').valueAsDate = startOfWeek;
            document.getElementById('leaderFilterEndDate').valueAsDate = today;
            updateLeaderDashboard();
        }

        function applyAdminFilters() {
            updateAdminDashboard();
            alert('ç­›é€‰å®Œæˆï¼');
        }

        function resetAdminFilters() {
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            
            document.getElementById('adminFilterStartDate').valueAsDate = startOfWeek;
            document.getElementById('adminFilterEndDate').valueAsDate = today;
            document.getElementById('adminFilterDept').value = '';
            updateAdminDashboard();
        }

        function exportToExcel() {
            if (filteredProjects.length === 0) {
                alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡ºï¼');
                return;
            }
            
            const data = filteredProjects.map(p => ({
                'å®¢æˆ·': p.clientName,
                'é¡¹ç›®': p.projectName,
                'è§„æ¨¡(Â£K)': p.projectScale,
                'ç±»å‹': p.projectType === 'presales' ? 'å”®å‰' : 'å”®å',
                'å·¥ä½œæ—¶é•¿(h)': p.workLogs ? p.workLogs.reduce((sum, log) => sum + (log.type === 'normal' ? parseFloat(log.hours) : 0), 0).toFixed(1) : '0',
                'åŠ ç­æ—¶é•¿(h)': p.workLogs ? p.workLogs.reduce((sum, log) => sum + (log.type === 'overtime' ? parseFloat(log.hours) : 0), 0).toFixed(1) : '0'
            }));
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "é¡¹ç›®æ•°æ®");
            XLSX.writeFile(wb, 'ä¸ªäººå‘¨æŠ¥_' + new Date().getTime() + '.xlsx');
        }

        function exportLeaderToExcel() {
            alert('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
        }

        function exportAdminToExcel() {
            alert('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
        }

        function renderProjectsList() {
            const tbody = document.getElementById('projectsTableBody');
            if (projects.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px; color: #9ca3af;">æš‚æ— é¡¹ç›®</td></tr>';
                document.getElementById('projectListCount').textContent = '0';
                return;
            }

            let html = '';
            projects.forEach((project, index) => {
                let workHours = 0, overtimeHours = 0;
                if (project.workLogs) {
                    project.workLogs.forEach(log => {
                        const hours = parseFloat(log.hours || 0);
                        if (log.type === 'overtime') {
                            overtimeHours += hours;
                        } else {
                            workHours += hours;
                        }
                    });
                }
                
                const typeText = project.projectType === 'presales' ? 'å”®å‰' : 'å”®å';
                const specialtyBadge = `<span class="badge badge-${project.specialty === 'ç½‘ç»œ' ? 'network' : (project.specialty === 'ç³»ç»Ÿ' ? 'system' : 'infra')}">${project.specialty}</span>`;
                
                html += `
                    <tr>
                        <td>${project.clientName}</td>
                        <td>${project.projectName}</td>
                        <td>${project.industry}</td>
                        <td>Â£${parseFloat(project.projectScale).toFixed(1)}K</td>
                        <td>${typeText}</td>
                        <td>${specialtyBadge}</td>
                        <td>${workHours.toFixed(1)}h</td>
                        <td><span style="color: #ef4444;">${overtimeHours.toFixed(1)}h</span></td>
                        <td><button class="btn btn-danger btn-sm" onclick="deleteProject(${index})">åˆ é™¤</button></td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            document.getElementById('projectListCount').textContent = projects.length;
        }

        function saveProject(e) {
            e.preventDefault();
            
            const newProject = {
                weekStartDate: document.getElementById('weekStartDate').value,
                clientName: document.getElementById('clientName').value,
                projectName: document.getElementById('projectName').value,
                industry: document.getElementById('industry').value,
                projectScale: document.getElementById('projectScale').value,
                specialty: document.getElementById('specialty').value,
                projectType: document.getElementById('projectType').value,
                signedStatus: document.getElementById('projectType').value === 'presales' ? document.getElementById('signedStatus').value : 'n/a',
                workLogs: [],
                createdAt: new Date().toISOString()
            };

            projects.push(newProject);
            localStorage.setItem('projects_' + currentUser.email, JSON.stringify(projects));
            
            alert('é¡¹ç›®å·²ä¿å­˜ï¼');
            resetForm();
            filteredProjects = projects;
            updateUserDashboard();
            switchTab('projects');
        }

        function deleteProject(index) {
            if (!confirm('ç¡®å®šåˆ é™¤è¯¥é¡¹ç›®å—ï¼Ÿ')) return;
            projects.splice(index, 1);
            localStorage.setItem('projects_' + currentUser.email, JSON.stringify(projects));
            filteredProjects = projects;
            renderProjectsList();
            updateUserDashboard();
        }

        function resetForm() {
            document.getElementById('projectForm').reset();
            const today = new Date();
            document.getElementById('weekStartDate').valueAsDate = today;
        }

        function openUserProfileModal() {
            if (currentUserProfile) {
                document.getElementById('profileName').value = currentUserProfile.name || '';
                document.getElementById('profileEmail').value = currentUserProfile.email || '';
                document.getElementById('profileDept').value = currentUserProfile.department || '';
                document.getElementById('profileSpecialty').value = currentUserProfile.specialty || '';
            }
            document.getElementById('userProfileModal').classList.add('active');
        }

        function closeUserProfileModal() {
            document.getElementById('userProfileModal').classList.remove('active');
        }

        function logout() {
            currentUser = null;
            currentUserProfile = null;
            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('pendingPage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('userSection').style.display = 'none';
        }
    </script>
</body>
</html>
