<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¹ç›®ç®¡ç† - å·¥ç¨‹å¸ˆå·¥æ—¶ç³»ç»Ÿ</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="js/countries-list.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; background: #f5f7fa; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .header-title { display: flex; align-items: center; gap: 12px; }
        .header-actions { display: flex; gap: 15px; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; text-decoration: none; display: inline-block; }
        .btn-primary { background: white; color: #667eea; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255,255,255,0.3); }
        .btn-secondary { background: rgba(255,255,255,0.2); color: white; border: 1px solid white; }
        .btn-secondary:hover { background: rgba(255,255,255,0.3); }
        .container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; position: relative; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s; }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; }
        .stat-card.presales::before { background: linear-gradient(90deg, #667eea, #764ba2); }
        .stat-card.postsales::before { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .stat-card.signed::before { background: linear-gradient(90deg, #10b981, #059669); }
        .stat-card.reported::before { background: linear-gradient(90deg, #3b82f6, #2563eb); }
        .stat-card.active::before { background: linear-gradient(90deg, #8b5cf6, #7c3aed); }
        .stat-icon { font-size: 32px; margin-bottom: 8px; }
        .stat-value { font-size: 28px; font-weight: bold; color: #333; }
        .stat-label { font-size: 13px; color: #666; margin-top: 5px; }
        .stat-sub { font-size: 11px; color: #999; margin-top: 3px; }
        
        /* ç­›é€‰åŒºåŸŸ */
        .filters { background: white; padding: 20px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .filter-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .filter-header-title { font-size: 14px; font-weight: 600; color: #333; display: flex; align-items: center; gap: 8px; }
        .filter-count { background: #667eea; color: white; padding: 2px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .filter-actions { display: flex; gap: 10px; }
        .btn-toggle-advanced { background: #f0f4ff; color: #667eea; border: 1px solid #e0e7ff; padding: 8px 16px; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: 500; transition: all 0.2s; }
        .btn-toggle-advanced:hover { background: #e0e7ff; }
        .btn-toggle-advanced.active { background: #667eea; color: white; border-color: #667eea; }
        .btn-clear-filters { background: #fff5f5; color: #e53e3e; border: 1px solid #fed7d7; padding: 8px 16px; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: 500; display: none; }
        .btn-clear-filters.show { display: inline-flex; align-items: center; gap: 5px; }
        .btn-clear-filters:hover { background: #fed7d7; }
        .filter-row { display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; }
        .filter-group { display: flex; flex-direction: column; gap: 5px; min-width: 150px; }
        .filter-group.search-group { flex: 1; min-width: 200px; }
        .filter-label { font-size: 12px; color: #666; font-weight: 500; }
        .filter-select, .filter-input { padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .filter-select:focus, .filter-input:focus { outline: none; border-color: #667eea; }
        
        /* é«˜çº§ç­›é€‰ */
        .advanced-filters { display: none; margin-top: 20px; padding-top: 20px; border-top: 2px dashed #e5e7eb; }
        .advanced-filters.show { display: block; }
        .advanced-section { margin-bottom: 20px; }
        .advanced-section:last-child { margin-bottom: 0; }
        .advanced-section-title { font-size: 13px; font-weight: 600; color: #4a5568; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .advanced-section-title::before { content: ''; width: 4px; height: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 2px; }
        .advanced-filter-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        
        /* é‡‘é¢ç­›é€‰ */
        .amount-filter-section { background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; }
        .amount-presets { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
        .amount-preset-btn { padding: 6px 14px; border: 2px solid #e2e8f0; background: white; border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.2s; color: #4a5568; }
        .amount-preset-btn:hover { border-color: #667eea; color: #667eea; }
        .amount-preset-btn.active { border-color: #667eea; background: #667eea; color: white; }
        .amount-custom-range { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .amount-custom-range label { font-size: 13px; color: #666; }
        .amount-input { width: 100px; padding: 8px 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .amount-input:focus { outline: none; border-color: #667eea; }
        .currency-badge { background: #e2e8f0; padding: 6px 12px; border-radius: 4px; font-size: 13px; color: #4a5568; }
        
        /* ä¸šç»©ç­›é€‰ */
        .performance-filter-section { background: #f0fdf4; padding: 15px; border-radius: 8px; border: 1px solid #bbf7d0; }
        .performance-checkboxes { display: flex; flex-wrap: wrap; gap: 15px; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .checkbox-item input[type="checkbox"] { width: 18px; height: 18px; accent-color: #667eea; cursor: pointer; }
        .checkbox-item label { font-size: 14px; color: #333; cursor: pointer; }
        
        /* å·¥ç¨‹å¸ˆç­›é€‰ */
        .engineer-filter-section { background: #fef3c7; padding: 15px; border-radius: 8px; border: 1px solid #fcd34d; }
        .engineer-filter-section.hidden { display: none; }
        .admin-badge { background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; margin-left: 8px; }
        
        /* æ´»è·ƒç­›é€‰æ ‡ç­¾ */
        .active-filters { display: none; flex-wrap: wrap; gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb; }
        .active-filters.show { display: flex; }
        .active-filter-tag { display: inline-flex; align-items: center; gap: 6px; padding: 5px 12px; background: #eef2ff; color: #667eea; border-radius: 20px; font-size: 13px; font-weight: 500; }
        .active-filter-tag .remove-tag { cursor: pointer; font-size: 16px; line-height: 1; opacity: 0.7; }
        .active-filter-tag .remove-tag:hover { opacity: 1; }

        /* è§†å›¾åˆ‡æ¢ */
        .view-toggle { display: flex; gap: 5px; margin-left: auto; }
        .view-btn { padding: 8px 16px; border: 2px solid #e0e0e0; background: white; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s; display: flex; align-items: center; gap: 5px; }
        .view-btn:hover { border-color: #667eea; background: #f8f9ff; }
        .view-btn.active { border-color: #667eea; background: #667eea; color: white; }
        
        /* å¡ç‰‡è§†å›¾ */
        .projects-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .projects-grid.hidden { display: none; }
        .project-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.3s; position: relative; }
        .project-card:hover { transform: translateY(-5px); box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .performance-badges { position: absolute; top: 15px; right: 15px; display: flex; gap: 5px; }
        .perf-badge { padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .perf-badge.signed { background: #d1fae5; color: #059669; }
        .perf-badge.reported { background: #dbeafe; color: #2563eb; }
        .project-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; padding-right: 80px; }
        .project-name { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 5px; }
        .project-customer { font-size: 14px; color: #667eea; font-weight: 600; }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; white-space: nowrap; }
        .status-planning { background: #fff3cd; color: #856404; }
        .status-active { background: #d4edda; color: #155724; }
        .status-completed { background: #d1ecf1; color: #0c5460; }
        .status-paused { background: #e2e3e5; color: #383d41; }
        .project-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0; }
        .meta-item { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #666; }
        .meta-icon { font-size: 16px; }
        .project-stats { display: flex; justify-content: space-between; padding: 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px; }
        .stat-item { text-align: center; }
        .stat-item-value { font-size: 20px; font-weight: bold; color: #667eea; }
        .stat-item-label { font-size: 11px; color: #666; margin-top: 3px; }
        .project-actions { display: flex; gap: 8px; }
        .action-btn { flex: 1; padding: 8px; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-view { background: #667eea; color: white; }
        .btn-view:hover { background: #5a6fd6; }
        .btn-edit { background: #f0f0f0; color: #333; }
        .btn-edit:hover { background: #e0e0e0; }

        /* åˆ—è¡¨è§†å›¾ */
        .projects-list { display: none; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .projects-list.show { display: block; }
        .list-header { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr 0.8fr 120px; padding: 15px 20px; background: #f8f9fa; border-bottom: 2px solid #e0e0e0; font-weight: 600; font-size: 13px; color: #666; }
        .list-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr 0.8fr 120px; padding: 15px 20px; border-bottom: 1px solid #f0f0f0; align-items: center; cursor: pointer; transition: background 0.2s; }
        .list-row:hover { background: #f8f9ff; }
        .list-row:last-child { border-bottom: none; }
        .list-project-name { font-weight: 600; color: #333; margin-bottom: 3px; }
        .list-customer-name { font-size: 12px; color: #667eea; }
        .list-cell { font-size: 13px; color: #666; }
        .list-cell.amount { font-weight: 600; color: #333; }
        .list-cell.hours { font-weight: 600; color: #667eea; }
        .list-perf-badges { display: flex; gap: 4px; }
        .list-perf-badge { padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 600; }
        .list-perf-badge.signed { background: #d1fae5; color: #059669; }
        .list-perf-badge.reported { background: #dbeafe; color: #2563eb; }
        .list-actions { display: flex; gap: 5px; }
        .list-action-btn { padding: 6px 12px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .list-btn-view { background: #667eea; color: white; }
        .list-btn-view:hover { background: #5a6fd6; }
        .list-btn-edit { background: #f0f0f0; color: #333; }
        .list-btn-edit:hover { background: #e0e0e0; }
        
        /* ç©ºçŠ¶æ€å’ŒåŠ è½½ */
        .empty-state { text-align: center; padding: 60px 20px; background: white; border-radius: 12px; }
        .empty-icon { font-size: 64px; margin-bottom: 20px; }
        .empty-text { color: #666; margin-bottom: 20px; }
        .loading { text-align: center; padding: 60px 20px; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* å“åº”å¼ */
        @media (max-width: 1200px) {
            .list-header, .list-row { grid-template-columns: 2fr 1fr 1fr 1fr 100px; }
            .list-header > *:nth-child(4), .list-row > *:nth-child(4),
            .list-header > *:nth-child(6), .list-row > *:nth-child(6),
            .list-header > *:nth-child(7), .list-row > *:nth-child(7) { display: none; }
        }
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 15px; }
            .filter-row { flex-direction: column; }
            .filter-group { width: 100%; }
            .view-toggle { margin-left: 0; width: 100%; justify-content: center; }
            .projects-grid { grid-template-columns: 1fr; }
            .advanced-filter-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-title"><h1>ğŸ“ é¡¹ç›®ç®¡ç†</h1></div>
            <div class="header-actions">
                <a href="create-project.html" class="btn btn-primary">â• æ–°å»ºé¡¹ç›®</a>
                <a href="project-recycle-bin.html" class="btn btn-secondary" style="background: rgba(220,38,38,0.2); border-color: #fca5a5;">ğŸ—‘ï¸ å›æ”¶ç«™</a>
                <a href="dashboard.html" class="btn btn-secondary">ğŸ  è¿”å›é¦–é¡µ</a>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="stats-grid">
            <div class="stat-card presales"><div class="stat-icon">ğŸ“‹</div><div class="stat-value" id="presales-count">0</div><div class="stat-label">å”®å‰é¡¹ç›®</div></div>
            <div class="stat-card postsales"><div class="stat-icon">ğŸ”§</div><div class="stat-value" id="postsales-count">0</div><div class="stat-label">å”®åé¡¹ç›®</div></div>
            <div class="stat-card signed"><div class="stat-icon">âœ…</div><div class="stat-value" id="signed-count">0</div><div class="stat-label">å·²ç­¾çº¦</div><div class="stat-sub">å”®å‰é¡¹ç›®</div></div>
            <div class="stat-card reported"><div class="stat-icon">ğŸ“</div><div class="stat-value" id="reported-count">0</div><div class="stat-label">å·²æŠ¥ç«£</div><div class="stat-sub">å”®åé¡¹ç›®</div></div>
            <div class="stat-card active"><div class="stat-icon">âš¡</div><div class="stat-value" id="active-projects">0</div><div class="stat-label">è¿›è¡Œä¸­</div></div>
        </div>
        
        <div class="filters">
            <div class="filter-header">
                <div class="filter-header-title">ğŸ” ç­›é€‰æ¡ä»¶ <span class="filter-count" id="filter-count">0</span></div>
                <div class="filter-actions">
                    <button class="btn-clear-filters" id="btn-clear-filters" onclick="clearAllFilters()">âœ• æ¸…é™¤ç­›é€‰</button>
                    <button class="btn-toggle-advanced" id="btn-toggle-advanced" onclick="toggleAdvancedFilters()">âš™ï¸ é«˜çº§ç­›é€‰</button>
                </div>
            </div>
            
            <div class="filter-row">
                <div class="filter-group search-group">
                    <label class="filter-label">æœç´¢é¡¹ç›®/å®¢æˆ·</label>
                    <input type="text" id="search-filter" class="filter-input" placeholder="è¾“å…¥é¡¹ç›®åç§°æˆ–å®¢æˆ·åç§°..." onkeyup="applyFilters()">
                </div>
                <div class="filter-group">
                    <label class="filter-label">é¡¹ç›®çŠ¶æ€</label>
                    <select id="status-filter" class="filter-select" onchange="applyFilters()">
                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                        <option value="è§„åˆ’ä¸­">è§„åˆ’ä¸­</option>
                        <option value="è¿›è¡Œä¸­">è¿›è¡Œä¸­</option>
                        <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
                        <option value="å·²æš‚åœ">å·²æš‚åœ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">é¡¹ç›®ç±»å‹</label>
                    <select id="type-filter" class="filter-select" onchange="applyFilters()">
                        <option value="">å…¨éƒ¨ç±»å‹</option>
                        <option value="å”®å‰é¡¹ç›®">å”®å‰é¡¹ç›®</option>
                        <option value="å”®åé¡¹ç›®">å”®åé¡¹ç›®</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">é”€å”®äººå‘˜</label>
                    <select id="sales-filter" class="filter-select" onchange="applyFilters()">
                        <option value="">å…¨éƒ¨é”€å”®</option>
                    </select>
                </div>
                <div class="view-toggle">
                    <button class="view-btn active" id="card-view-btn" onclick="switchView('card')">ğŸ—‚ï¸ å¡ç‰‡</button>
                    <button class="view-btn" id="list-view-btn" onclick="switchView('list')">ğŸ“‹ åˆ—è¡¨</button>
                </div>
            </div>
            
            <div class="advanced-filters" id="advanced-filters">
                <div class="advanced-section">
                    <div class="advanced-section-title">åœ°åŸŸä¸è¡Œä¸š</div>
                    <div class="advanced-filter-grid">
                        <div class="filter-group">
                            <label class="filter-label">å®¢æˆ·å›½å®¶</label>
                            <select id="country-filter" class="filter-select" onchange="applyFilters()">
                                <option value="">å…¨éƒ¨å›½å®¶</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">å®¢æˆ·è¡Œä¸š</label>
                            <select id="industry-filter" class="filter-select" onchange="applyFilters()">
                                <option value="">å…¨éƒ¨è¡Œä¸š</option>
                                <option value="é“¶è¡Œ">é“¶è¡Œ</option>
                                <option value="é‡‘è">é‡‘è</option>
                                <option value="ç§‘æŠ€">ç§‘æŠ€</option>
                                <option value="åˆ¶é€ ">åˆ¶é€ </option>
                                <option value="é›¶å”®">é›¶å”®</option>
                                <option value="ç‰©æµ">ç‰©æµ</option>
                                <option value="èƒ½æº">èƒ½æº</option>
                                <option value="æ•™è‚²">æ•™è‚²</option>
                                <option value="åŒ»ç–—">åŒ»ç–—</option>
                                <option value="æ”¿åºœ">æ”¿åºœ</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="advanced-section">
                    <div class="advanced-section-title">é¡¹ç›®é‡‘é¢</div>
                    <div class="amount-filter-section">
                        <div class="amount-presets">
                            <button class="amount-preset-btn active" data-min="" data-max="" onclick="setAmountPreset(this)">å…¨éƒ¨</button>
                            <button class="amount-preset-btn" data-min="0" data-max="50000" onclick="setAmountPreset(this)">ï¼œ50K</button>
                            <button class="amount-preset-btn" data-min="50000" data-max="100000" onclick="setAmountPreset(this)">50K-100K</button>
                            <button class="amount-preset-btn" data-min="100000" data-max="500000" onclick="setAmountPreset(this)">100K-500K</button>
                            <button class="amount-preset-btn" data-min="500000" data-max="" onclick="setAmountPreset(this)">ï¼500K</button>
                            <button class="amount-preset-btn" data-custom="true" onclick="toggleCustomAmount()">è‡ªå®šä¹‰</button>
                        </div>
                        <div class="amount-custom-range" id="custom-amount-range" style="display: none;">
                            <label>ä»</label>
                            <input type="number" id="amount-min" class="amount-input" placeholder="æœ€å°" onchange="applyFilters()">
                            <label>åˆ°</label>
                            <input type="number" id="amount-max" class="amount-input" placeholder="æœ€å¤§" onchange="applyFilters()">
                            <span class="currency-badge">GBP</span>
                        </div>
                    </div>
                </div>
                
                <div class="advanced-section">
                    <div class="advanced-section-title">ä¸šç»©çŠ¶æ€</div>
                    <div class="performance-filter-section">
                        <div class="performance-checkboxes">
                            <div class="checkbox-item"><input type="checkbox" id="filter-signed" onchange="applyFilters()"><label for="filter-signed">âœ… å·²ç­¾çº¦ï¼ˆå”®å‰ï¼‰</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="filter-unsigned" onchange="applyFilters()"><label for="filter-unsigned">â³ æœªç­¾çº¦ï¼ˆå”®å‰ï¼‰</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="filter-reported" onchange="applyFilters()"><label for="filter-reported">ğŸ“‹ å·²æŠ¥ç«£ï¼ˆå”®åï¼‰</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="filter-unreported" onchange="applyFilters()"><label for="filter-unreported">ğŸ”„ æœªæŠ¥ç«£ï¼ˆå”®åï¼‰</label></div>
                        </div>
                    </div>
                </div>
                
                <div class="advanced-section engineer-filter-section hidden" id="engineer-filter-section">
                    <div class="advanced-section-title">å·¥ç¨‹å¸ˆç­›é€‰ <span class="admin-badge">ç®¡ç†å‘˜</span></div>
                    <div class="advanced-filter-grid">
                        <div class="filter-group">
                            <label class="filter-label">å‚ä¸å·¥ç¨‹å¸ˆ</label>
                            <select id="engineer-filter" class="filter-select" onchange="applyFilters()">
                                <option value="">å…¨éƒ¨å·¥ç¨‹å¸ˆ</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">æŠ€æœ¯æ–¹å‘</label>
                            <select id="tech-direction-filter" class="filter-select" onchange="applyFilters()">
                                <option value="">å…¨éƒ¨æ–¹å‘</option>
                                <option value="ç½‘ç»œ">ç½‘ç»œ</option>
                                <option value="ç³»ç»Ÿ">ç³»ç»Ÿ</option>
                                <option value="èƒ½åŸº">èƒ½åŸº</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="active-filters" id="active-filters"></div>
        </div>
        
        <div class="loading" id="loading"><div class="spinner"></div><div>æ­£åœ¨åŠ è½½é¡¹ç›®...</div></div>
        <div class="projects-grid hidden" id="projects-grid"></div>
        <div class="projects-list" id="projects-list">
            <div class="list-header">
                <div>é¡¹ç›®åç§° / å®¢æˆ·</div><div>é˜¶æ®µ</div><div>ç±»å‹</div><div>å›½å®¶</div><div>é”€å”®</div><div>é‡‘é¢</div><div>ä¸šç»©</div><div>æ“ä½œ</div>
            </div>
            <div id="list-body"></div>
        </div>
        <div id="empty-state" class="empty-state" style="display: none;">
            <div class="empty-icon">ğŸ“</div>
            <div class="empty-text">æš‚æ— ç¬¦åˆæ¡ä»¶çš„é¡¹ç›®</div>
            <button class="btn btn-primary" onclick="clearAllFilters()">æ¸…é™¤ç­›é€‰æ¡ä»¶</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBzcAr_OJFdIMnaYXRCE7TJs2qlK_TAy9U",
            authDomain: "weekly-report-d55e9.firebaseapp.com",
            projectId: "weekly-report-d55e9",
            storageBucket: "weekly-report-d55e9.appspot.com",
            messagingSenderId: "315332641675",
            appId: "1:315332641675:web:e1b52c3d4c5fcc7b8c0de7"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        let currentUser = null, userData = null, allProjects = [], filteredProjects = [], allEngineers = [];
        let currentView = 'card', amountPreset = { min: '', max: '' };

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
                await loadEngineers();
                await loadProjects();
                initializeCountryFilter();
            } else {
                window.location.href = 'index.html';
            }
        });

        async function loadUserData() {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    userData = userDoc.data();
                    if (userData.role === 'admin' || userData.role === 'team_lead') {
                        document.getElementById('engineer-filter-section').classList.remove('hidden');
                    }
                } else {
                    userData = { role: 'engineer' };
                }
            } catch (error) {
                userData = { role: 'engineer' };
            }
        }

        async function loadEngineers() {
            try {
                const snapshot = await db.collection('users').where('status', '==', 'approved').get();
                allEngineers = [];
                const engineerSelect = document.getElementById('engineer-filter');
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const name = data.fullName || data.displayName || data.name || data.email?.split('@')[0] || data.email;
                    allEngineers.push({ id: doc.id, name, email: data.email, techDirection: data.techDirection || '', ...data });
                    if (engineerSelect) {
                        const option = document.createElement('option');
                        option.value = doc.id;
                        option.textContent = name;
                        engineerSelect.appendChild(option);
                    }
                });
            } catch (e) { console.error('åŠ è½½å·¥ç¨‹å¸ˆå¤±è´¥:', e); }
        }

        function initializeCountryFilter() {
            const countrySelect = document.getElementById('country-filter');
            if (!countrySelect) return;
            const commonCountries = ['è‹±å›½', 'å¾·å›½', 'æ³•å›½', 'æ„å¤§åˆ©', 'è¥¿ç­ç‰™', 'è·å…°', 'æ¯”åˆ©æ—¶', 'ä¸­å›½', 'é¦™æ¸¯', 'æ—¥æœ¬', 'æ–°åŠ å¡', 'ç¾å›½', 'åŠ æ‹¿å¤§', 'æ¾³å¤§åˆ©äºš'];
            if (typeof countryList !== 'undefined' && Array.isArray(countryList)) {
                countryList.forEach(country => { const opt = document.createElement('option'); opt.value = country; opt.textContent = country; countrySelect.appendChild(opt); });
            } else {
                commonCountries.forEach(country => { const opt = document.createElement('option'); opt.value = country; opt.textContent = country; countrySelect.appendChild(opt); });
            }
        }

        async function loadProjects() {
            try {
                let query = db.collection('projects');
                if (!(userData && (userData.role === 'admin' || userData.role === 'team_lead'))) {
                    query = query.where('assignedEngineers', 'array-contains', currentUser.uid);
                }
                const snapshot = await query.get();
                allProjects = [];
                const salesSet = new Set();
                
                for (const doc of snapshot.docs) {
                    const projectData = doc.data();
                    
                    // è¿‡æ»¤å·²åˆ é™¤çš„é¡¹ç›®ï¼ˆè½¯åˆ é™¤ï¼‰
                    if (projectData.deleted) continue;
                    
                    let totalHours = 0, totalSessions = 0, engineerSet = new Set();
                    try {
                        const recordsSnapshot = await db.collection('workRecords').where('projectId', '==', doc.id).get();
                        recordsSnapshot.forEach(record => {
                            const recordData = record.data();
                            totalHours += recordData.workHours || 0;
                            totalSessions++;
                            if (recordData.engineerId) engineerSet.add(recordData.engineerId);
                        });
                    } catch (e) {}
                    if (projectData.salesPerson) salesSet.add(projectData.salesPerson);
                    allProjects.push({ id: doc.id, ...projectData, totalWorkHours: totalHours, totalSessions, engineerCount: engineerSet.size });
                }
                
                populateSalesFilter(salesSet);
                filteredProjects = [...allProjects];
                document.getElementById('loading').style.display = 'none';
                updateStats();
                renderProjects();
                updateFilterCount();
            } catch (error) {
                document.getElementById('loading').innerHTML = `<div style="color: #e53e3e;">åŠ è½½å¤±è´¥: ${error.message}</div>`;
            }
        }

        function populateSalesFilter(salesSet) {
            const salesSelect = document.getElementById('sales-filter');
            if (salesSelect) {
                salesSet.forEach(sales => { const opt = document.createElement('option'); opt.value = sales; opt.textContent = sales; salesSelect.appendChild(opt); });
            }
        }

        function toggleAdvancedFilters() {
            const advFilters = document.getElementById('advanced-filters');
            const toggleBtn = document.getElementById('btn-toggle-advanced');
            advFilters.classList.toggle('show');
            toggleBtn.classList.toggle('active');
            toggleBtn.innerHTML = advFilters.classList.contains('show') ? 'âš™ï¸ æ”¶èµ·é«˜çº§ç­›é€‰' : 'âš™ï¸ é«˜çº§ç­›é€‰';
        }

        function setAmountPreset(btn) {
            document.querySelectorAll('.amount-preset-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if (btn.dataset.custom === 'true') { document.getElementById('custom-amount-range').style.display = 'flex'; return; }
            document.getElementById('custom-amount-range').style.display = 'none';
            amountPreset.min = btn.dataset.min;
            amountPreset.max = btn.dataset.max;
            document.getElementById('amount-min').value = '';
            document.getElementById('amount-max').value = '';
            applyFilters();
        }

        function toggleCustomAmount() {
            const customRange = document.getElementById('custom-amount-range');
            customRange.style.display = customRange.style.display === 'none' ? 'flex' : 'none';
            amountPreset = { min: '', max: '' };
        }

        function applyFilters() {
            const searchText = (document.getElementById('search-filter')?.value || '').toLowerCase().trim();
            const statusFilter = document.getElementById('status-filter')?.value || '';
            const typeFilter = document.getElementById('type-filter')?.value || '';
            const salesFilter = document.getElementById('sales-filter')?.value || '';
            const countryFilter = document.getElementById('country-filter')?.value || '';
            const industryFilter = document.getElementById('industry-filter')?.value || '';
            const engineerFilter = document.getElementById('engineer-filter')?.value || '';
            const techDirectionFilter = document.getElementById('tech-direction-filter')?.value || '';
            
            let amountMin = parseFloat(document.getElementById('amount-min')?.value) || null;
            let amountMax = parseFloat(document.getElementById('amount-max')?.value) || null;
            if (amountMin === null && amountPreset.min !== '') amountMin = parseFloat(amountPreset.min);
            if (amountMax === null && amountPreset.max !== '') amountMax = parseFloat(amountPreset.max);
            
            const filterSigned = document.getElementById('filter-signed')?.checked;
            const filterUnsigned = document.getElementById('filter-unsigned')?.checked;
            const filterReported = document.getElementById('filter-reported')?.checked;
            const filterUnreported = document.getElementById('filter-unreported')?.checked;
            
            filteredProjects = allProjects.filter(project => {
                if (searchText) {
                    const pName = (project.projectName || '').toLowerCase();
                    const cName = (project.customerName || '').toLowerCase();
                    if (!pName.includes(searchText) && !cName.includes(searchText)) return false;
                }
                if (statusFilter && project.status !== statusFilter) return false;
                if (typeFilter && project.projectType !== typeFilter) return false;
                if (salesFilter && project.salesPerson !== salesFilter) return false;
                if (countryFilter && project.customerCountry !== countryFilter) return false;
                if (industryFilter && project.customerIndustry !== industryFilter) return false;
                
                const projectAmount = project.projectAmount || 0;
                if (amountMin !== null && projectAmount < amountMin) return false;
                if (amountMax !== null && projectAmount > amountMax) return false;
                
                const perf = project.performanceData || {};
                if (filterSigned && !(project.projectType === 'å”®å‰é¡¹ç›®' && perf.contractSigned)) return false;
                if (filterUnsigned && !(project.projectType === 'å”®å‰é¡¹ç›®' && !perf.contractSigned)) return false;
                if (filterReported && !(project.projectType === 'å”®åé¡¹ç›®' && perf.reported)) return false;
                if (filterUnreported && !(project.projectType === 'å”®åé¡¹ç›®' && !perf.reported)) return false;
                
                if (engineerFilter) {
                    const presalesAlloc = perf.presalesAllocation || [];
                    const postsalesAlloc = perf.postsalesAllocation || [];
                    const allAlloc = [...presalesAlloc, ...postsalesAlloc];
                    const hasEngineer = allAlloc.some(a => a.engineerId === engineerFilter);
                    const assigned = project.assignedEngineers || [];
                    const isCreator = project.createdBy === engineerFilter;
                    if (!hasEngineer && !assigned.includes(engineerFilter) && !isCreator) return false;
                }
                
                if (techDirectionFilter) {
                    // æ”¶é›†æ‰€æœ‰ä¸é¡¹ç›®ç›¸å…³çš„å·¥ç¨‹å¸ˆID
                    const relatedEngineerIds = new Set();
                    
                    // 1. ä¸šç»©åˆ†é…ä¸­çš„å·¥ç¨‹å¸ˆ
                    const presalesAlloc = perf.presalesAllocation || [];
                    const postsalesAlloc = perf.postsalesAllocation || [];
                    [...presalesAlloc, ...postsalesAlloc].forEach(a => {
                        if (a.engineerId) relatedEngineerIds.add(a.engineerId);
                    });
                    
                    // 2. æŒ‡æ´¾çš„å·¥ç¨‹å¸ˆ
                    (project.assignedEngineers || []).forEach(id => relatedEngineerIds.add(id));
                    
                    // 3. é¡¹ç›®åˆ›å»ºè€…
                    if (project.createdBy) relatedEngineerIds.add(project.createdBy);
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä¸€ç›¸å…³å·¥ç¨‹å¸ˆå±äºé€‰å®šçš„æŠ€æœ¯æ–¹å‘
                    const hasMatchingDirection = allEngineers.some(e => 
                        relatedEngineerIds.has(e.id) && e.techDirection === techDirectionFilter
                    );
                    
                    if (!hasMatchingDirection) return false;
                }
                
                return true;
            });
            
            renderProjects();
            updateFilterCount();
            updateActiveFilterTags();
        }

        function updateFilterCount() {
            document.getElementById('filter-count').textContent = filteredProjects.length;
            const activeCount = countActiveFilters();
            document.getElementById('btn-clear-filters').classList.toggle('show', activeCount > 0);
        }

        function countActiveFilters() {
            let count = 0;
            if (document.getElementById('search-filter')?.value) count++;
            if (document.getElementById('status-filter')?.value) count++;
            if (document.getElementById('type-filter')?.value) count++;
            if (document.getElementById('sales-filter')?.value) count++;
            if (document.getElementById('country-filter')?.value) count++;
            if (document.getElementById('industry-filter')?.value) count++;
            if (document.getElementById('engineer-filter')?.value) count++;
            if (document.getElementById('tech-direction-filter')?.value) count++;
            if (document.getElementById('amount-min')?.value || amountPreset.min) count++;
            if (document.getElementById('filter-signed')?.checked) count++;
            if (document.getElementById('filter-unsigned')?.checked) count++;
            if (document.getElementById('filter-reported')?.checked) count++;
            if (document.getElementById('filter-unreported')?.checked) count++;
            return count;
        }

        function updateActiveFilterTags() {
            const container = document.getElementById('active-filters');
            const tags = [];
            const searchVal = document.getElementById('search-filter')?.value;
            if (searchVal) tags.push({ label: `æœç´¢: ${searchVal}`, clear: () => { document.getElementById('search-filter').value = ''; applyFilters(); }});
            const statusVal = document.getElementById('status-filter')?.value;
            if (statusVal) tags.push({ label: `çŠ¶æ€: ${statusVal}`, clear: () => { document.getElementById('status-filter').value = ''; applyFilters(); }});
            const countryVal = document.getElementById('country-filter')?.value;
            if (countryVal) tags.push({ label: `å›½å®¶: ${countryVal}`, clear: () => { document.getElementById('country-filter').value = ''; applyFilters(); }});
            const amtMin = document.getElementById('amount-min')?.value || amountPreset.min;
            const amtMax = document.getElementById('amount-max')?.value || amountPreset.max;
            if (amtMin || amtMax) {
                const label = amtMin && amtMax ? `é‡‘é¢: ${(amtMin/1000)}K-${(amtMax/1000)}K` : amtMin ? `é‡‘é¢: >${(amtMin/1000)}K` : `é‡‘é¢: <${(amtMax/1000)}K`;
                tags.push({ label, clear: () => { 
                    document.getElementById('amount-min').value = ''; document.getElementById('amount-max').value = '';
                    amountPreset = { min: '', max: '' };
                    document.querySelectorAll('.amount-preset-btn').forEach(b => b.classList.remove('active'));
                    document.querySelector('.amount-preset-btn[data-min=""][data-max=""]')?.classList.add('active');
                    applyFilters(); 
                }});
            }
            if (document.getElementById('filter-signed')?.checked) tags.push({ label: 'å·²ç­¾çº¦', clear: () => { document.getElementById('filter-signed').checked = false; applyFilters(); }});
            if (document.getElementById('filter-reported')?.checked) tags.push({ label: 'å·²æŠ¥ç«£', clear: () => { document.getElementById('filter-reported').checked = false; applyFilters(); }});
            
            if (tags.length > 0) {
                container.classList.add('show');
                container.innerHTML = tags.map((tag, i) => `<span class="active-filter-tag">${tag.label}<span class="remove-tag" onclick="window.clearFilterTag(${i})">Ã—</span></span>`).join('');
                window.filterTagClears = tags.map(t => t.clear);
            } else {
                container.classList.remove('show');
                container.innerHTML = '';
            }
        }

        window.clearFilterTag = function(index) { if (window.filterTagClears && window.filterTagClears[index]) window.filterTagClears[index](); };

        function clearAllFilters() {
            document.getElementById('search-filter').value = '';
            document.getElementById('status-filter').value = '';
            document.getElementById('type-filter').value = '';
            document.getElementById('sales-filter').value = '';
            document.getElementById('country-filter').value = '';
            document.getElementById('industry-filter').value = '';
            document.getElementById('engineer-filter').value = '';
            document.getElementById('tech-direction-filter').value = '';
            document.getElementById('amount-min').value = '';
            document.getElementById('amount-max').value = '';
            document.getElementById('filter-signed').checked = false;
            document.getElementById('filter-unsigned').checked = false;
            document.getElementById('filter-reported').checked = false;
            document.getElementById('filter-unreported').checked = false;
            amountPreset = { min: '', max: '' };
            document.querySelectorAll('.amount-preset-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.amount-preset-btn[data-min=""][data-max=""]')?.classList.add('active');
            document.getElementById('custom-amount-range').style.display = 'none';
            applyFilters();
        }

        function switchView(view) {
            currentView = view;
            document.getElementById('card-view-btn').classList.toggle('active', view === 'card');
            document.getElementById('list-view-btn').classList.toggle('active', view === 'list');
            document.getElementById('projects-grid').classList.toggle('hidden', view !== 'card');
            document.getElementById('projects-list').classList.toggle('show', view === 'list');
            renderProjects();
        }

        function renderProjects() {
            const grid = document.getElementById('projects-grid');
            const projectsList = document.getElementById('projects-list');
            const emptyState = document.getElementById('empty-state');
            
            if (filteredProjects.length === 0) {
                grid.classList.add('hidden');
                projectsList.classList.remove('show');
                emptyState.style.display = 'block';
                return;
            }
            emptyState.style.display = 'none';
            if (currentView === 'card') { grid.classList.remove('hidden'); projectsList.classList.remove('show'); renderCardView(); }
            else { grid.classList.add('hidden'); projectsList.classList.add('show'); renderListView(); }
        }

        function renderCardView() {
            const grid = document.getElementById('projects-grid');
            grid.innerHTML = filteredProjects.map(project => {
                const statusClass = { 'è§„åˆ’ä¸­': 'status-planning', 'è¿›è¡Œä¸­': 'status-active', 'å·²å®Œæˆ': 'status-completed', 'å·²æš‚åœ': 'status-paused' }[project.status] || 'status-planning';
                const perf = project.performanceData || {};
                const showSigned = project.projectType === 'å”®å‰é¡¹ç›®' && perf.contractSigned;
                const showReported = project.projectType === 'å”®åé¡¹ç›®' && perf.reported;
                // ä¿®å¤é‡‘é¢æ˜¾ç¤ºï¼šåªæœ‰å½“é‡‘é¢å­—æ®µä¸å­˜åœ¨æ—¶æ‰æ˜¾ç¤º -
                const hasAmount = project.projectAmount !== undefined && project.projectAmount !== null && project.projectAmount !== '';
                const amountDisplay = hasAmount ? (project.projectAmount/1000).toFixed(0) + 'K ' + (project.projectCurrency || 'GBP') : '-';
                return `
                    <div class="project-card" onclick="viewProject('${project.id}')">
                        <div class="performance-badges">
                            ${showSigned ? '<span class="perf-badge signed">å·²ç­¾çº¦</span>' : ''}
                            ${showReported ? '<span class="perf-badge reported">å·²æŠ¥ç«£</span>' : ''}
                        </div>
                        <div class="project-header">
                            <div class="project-title">
                                <div class="project-name">${project.projectName || 'æœªå‘½åé¡¹ç›®'}</div>
                                <div class="project-customer">${project.customerName || '-'}</div>
                            </div>
                            <span class="status-badge ${statusClass}">${project.status || 'æœªçŸ¥'}</span>
                        </div>
                        <div class="project-meta">
                            <div class="meta-item"><span class="meta-icon">ğŸ­</span><span>${project.customerIndustry || '-'}</span></div>
                            <div class="meta-item"><span class="meta-icon">ğŸŒ</span><span>${project.customerCountry || '-'}</span></div>
                            <div class="meta-item"><span class="meta-icon">ğŸ“‹</span><span>${project.projectType || '-'}</span></div>
                            <div class="meta-item"><span class="meta-icon">ğŸ‘¤</span><span>${project.salesPerson || '-'}</span></div>
                            <div class="meta-item"><span class="meta-icon">ğŸ’°</span><span>${amountDisplay}</span></div>
                            <div class="meta-item"><span class="meta-icon">ğŸ“…</span><span>${project.startDate || '-'}</span></div>
                        </div>
                        <div class="project-stats">
                            <div class="stat-item"><div class="stat-item-value">${(project.totalWorkHours || 0).toFixed(1)}</div><div class="stat-item-label">æ€»å·¥æ—¶</div></div>
                            <div class="stat-item"><div class="stat-item-value">${project.totalSessions || 0}</div><div class="stat-item-label">å·¥ä½œè®°å½•</div></div>
                            <div class="stat-item"><div class="stat-item-value">${project.engineerCount || 0}</div><div class="stat-item-label">å‚ä¸äººå‘˜</div></div>
                        </div>
                        <div class="project-actions" onclick="event.stopPropagation()">
                            <button class="action-btn btn-view" onclick="viewProject('${project.id}')">ğŸ‘ï¸ æŸ¥çœ‹</button>
                            <button class="action-btn btn-edit" onclick="editProject('${project.id}')">âœï¸ ç¼–è¾‘</button>
                        </div>
                    </div>`;
            }).join('');
        }

        function renderListView() {
            const listBody = document.getElementById('list-body');
            listBody.innerHTML = filteredProjects.map(project => {
                const statusClass = { 'è§„åˆ’ä¸­': 'status-planning', 'è¿›è¡Œä¸­': 'status-active', 'å·²å®Œæˆ': 'status-completed', 'å·²æš‚åœ': 'status-paused' }[project.status] || 'status-planning';
                // ä¿®å¤é‡‘é¢æ˜¾ç¤ºï¼šåªæœ‰å½“é‡‘é¢å­—æ®µä¸å­˜åœ¨æ—¶æ‰æ˜¾ç¤º -
                const hasAmount = project.projectAmount !== undefined && project.projectAmount !== null && project.projectAmount !== '';
                const amount = hasAmount ? (project.projectAmount/1000).toFixed(0) + 'K ' + (project.projectCurrency || 'GBP') : '-';
                const perf = project.performanceData || {};
                const showSigned = project.projectType === 'å”®å‰é¡¹ç›®' && perf.contractSigned;
                const showReported = project.projectType === 'å”®åé¡¹ç›®' && perf.reported;
                return `
                    <div class="list-row" onclick="viewProject('${project.id}')">
                        <div><div class="list-project-name">${project.projectName || 'æœªå‘½åé¡¹ç›®'}</div><div class="list-customer-name">${project.customerName || '-'}</div></div>
                        <div class="list-cell"><span class="status-badge ${statusClass}" style="font-size: 11px; padding: 3px 8px;">${project.projectStage || project.status || '-'}</span></div>
                        <div class="list-cell">${project.projectType || '-'}</div>
                        <div class="list-cell">${project.customerCountry || '-'}</div>
                        <div class="list-cell">${project.salesPerson || '-'}</div>
                        <div class="list-cell amount">${amount}</div>
                        <div class="list-cell"><div class="list-perf-badges">${showSigned ? '<span class="list-perf-badge signed">ç­¾çº¦</span>' : ''}${showReported ? '<span class="list-perf-badge reported">æŠ¥ç«£</span>' : ''}${!showSigned && !showReported ? '-' : ''}</div></div>
                        <div class="list-actions" onclick="event.stopPropagation()">
                            <button class="list-action-btn list-btn-view" onclick="viewProject('${project.id}')">æŸ¥çœ‹</button>
                            <button class="list-action-btn list-btn-edit" onclick="editProject('${project.id}')">ç¼–è¾‘</button>
                        </div>
                    </div>`;
            }).join('');
        }

        function updateStats() {
            // å”®å‰é¡¹ç›®æ•°
            const presalesCount = allProjects.filter(p => p.projectType === 'å”®å‰é¡¹ç›®').length;
            document.getElementById('presales-count').textContent = presalesCount;
            
            // å”®åé¡¹ç›®æ•°
            const postsalesCount = allProjects.filter(p => p.projectType === 'å”®åé¡¹ç›®').length;
            document.getElementById('postsales-count').textContent = postsalesCount;
            
            // å·²ç­¾çº¦é¡¹ç›®æ•°ï¼ˆå”®å‰é¡¹ç›®ä¸­å·²ç­¾çº¦çš„ï¼‰
            const signedCount = allProjects.filter(p => {
                if (p.projectType !== 'å”®å‰é¡¹ç›®') return false;
                const perf = p.performanceData || {};
                return perf.contractSigned === true;
            }).length;
            document.getElementById('signed-count').textContent = signedCount;
            
            // å·²æŠ¥ç«£é¡¹ç›®æ•°ï¼ˆå”®åé¡¹ç›®ä¸­å·²æŠ¥ç«£çš„ï¼‰
            const reportedCount = allProjects.filter(p => {
                if (p.projectType !== 'å”®åé¡¹ç›®') return false;
                const perf = p.performanceData || {};
                return perf.reported === true;
            }).length;
            document.getElementById('reported-count').textContent = reportedCount;
            
            // è¿›è¡Œä¸­é¡¹ç›®æ•°
            const activeCount = allProjects.filter(p => p.status === 'è¿›è¡Œä¸­').length;
            document.getElementById('active-projects').textContent = activeCount;
        }

        function viewProject(projectId) { window.location.href = `project-detail.html?id=${projectId}`; }
        function editProject(projectId) { window.location.href = `edit-project.html?id=${projectId}`; }
    </script>
</body>
</html>
