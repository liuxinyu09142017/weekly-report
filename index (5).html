<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼ä¸šçº§å·¥ä½œå‘¨æŠ¥ç³»ç»Ÿ V11</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f9fafb; padding: 16px; }
        .container { max-width: 1600px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .header { background: #1f2937; color: white; padding: 24px; }
        .header h1 { font-size: 28px; margin-bottom: 5px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .content { padding: 40px; }
        .login-center { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 400px; gap: 20px; }
        .login-title { font-size: 32px; text-align: center; margin-bottom: 20px; }
        .login-desc { font-size: 16px; color: #6b7280; text-align: center; margin-bottom: 30px; }
        .google-btn { padding: 14px 28px; background: white; border: 1px solid #dadce0; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 10px; }
        .google-btn:hover { background: #f8f9fa; border-color: #d0d0d0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status { margin-top: 20px; padding: 12px 20px; background: #e0e7ff; border-radius: 6px; color: #667eea; font-size: 14px; text-align: center; }
        .dashboard { display: none; }
        .dashboard.active { display: block; }
        .dash-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #e5e7eb; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; background: #2563eb; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; }
        .user-details h3 { margin: 0; font-size: 14px; font-weight: 600; }
        .user-details p { margin: 3px 0 0 0; font-size: 12px; color: #6b7280; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; }
        .btn-logout { background: #ef4444; color: white; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .stat-card { background: #f9fafb; padding: 16px; border-radius: 8px; border: 1px solid #e5e7eb; text-align: center; }
        .stat-label { font-size: 12px; color: #6b7280; margin-bottom: 8px; font-weight: 600; }
        .stat-value { font-size: 24px; font-weight: 700; color: #2563eb; }
        .info-box { background: #f0f4ff; border-left: 4px solid #2563eb; padding: 20px; border-radius: 8px; }
        .info-box h3 { margin-bottom: 12px; color: #2563eb; }
        .info-box p { margin: 6px 0; font-size: 13px; color: #374151; }
        .login-center { display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ä¼ä¸šçº§å·¥ä½œå‘¨æŠ¥ç³»ç»Ÿ V11</h1>
            <p>å¤šç”¨æˆ·äº‘ç«¯ç‰ˆ - Firestoreæ•°æ®åº“</p>
        </div>

        <!-- ç™»å½•é¡µ -->
        <div id="loginPage" class="content">
            <div class="login-center">
                <h2 class="login-title">æ¬¢è¿ç™»å½•</h2>
                <p class="login-desc">
                    ä½¿ç”¨Googleè´¦æˆ·ç™»å½•<br>
                    äº«å—äº‘ç«¯æ•°æ®åŒæ­¥æœåŠ¡
                </p>
                <button class="google-btn" onclick="signInWithGoogle()">
                    ğŸ” ä½¿ç”¨Googleè´¦æˆ·ç™»å½•
                </button>
                <div class="status" id="statusMsg">ç³»ç»Ÿå·²å°±ç»ª</div>
            </div>
        </div>

        <!-- ä»ªè¡¨æ¿ -->
        <div id="dashboard" class="content dashboard">
            <div class="dash-header">
                <h2>ä»ªè¡¨æ¿</h2>
                <div class="user-info">
                    <div class="avatar" id="userAvatar">ç”¨</div>
                    <div class="user-details">
                        <h3 id="userName">ç”¨æˆ·å</h3>
                        <p id="userEmail">é‚®ç®±</p>
                    </div>
                    <button class="btn btn-logout" onclick="logout()">ç™»å‡º</button>
                </div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">ç³»ç»ŸçŠ¶æ€</div>
                    <div class="stat-value">âœ…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ•°æ®åº“</div>
                    <div class="stat-value">â˜ï¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">è®¤è¯æ–¹å¼</div>
                    <div class="stat-value">ğŸ”’</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ç‰ˆæœ¬</div>
                    <div class="stat-value">V11</div>
                </div>
            </div>

            <div class="info-box">
                <h3>ğŸ‰ ç³»ç»Ÿå·²å°±ç»ªï¼</h3>
                <p><strong>å½“å‰ç”¨æˆ·ï¼š</strong> <span id="currentUser">-</span></p>
                <p><strong>é¡¹ç›®IDï¼š</strong> weekly-report-d55e9</p>
                <p><strong>æ•°æ®åº“ï¼š</strong> Google Firestore</p>
                <p><strong>è®¤è¯ï¼š</strong> Firebase Google OAuth</p>
                <p><strong>çŠ¶æ€ï¼š</strong> âœ… æ­£å¸¸è¿è¡Œ</p>
            </div>
        </div>
    </div>

    <!-- Google Sign-Inåº“ -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <script>
        let currentUser = null;

        // åˆå§‹åŒ–Google Sign-In
        window.onload = function() {
            google.accounts.id.initialize({
                client_id: '1018033981926-cg6bl58ehp3kpm0rlcr7vlgeg8iore3g.apps.googleusercontent.com',
                callback: handleCredentialResponse
            });
        };

        // å¤„ç†Googleç™»å½•å“åº”
        function handleCredentialResponse(response) {
            console.log('Googleç™»å½•æˆåŠŸ:', response);
            
            // è§£ç JWT tokenè·å–ç”¨æˆ·ä¿¡æ¯
            const base64Url = response.credential.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(
                atob(base64).split('').map(c => {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join('')
            );
            
            currentUser = JSON.parse(jsonPayload);
            console.log('ç”¨æˆ·ä¿¡æ¯:', currentUser);
            showDashboard();
        }

        // Googleç™»å½•
        function signInWithGoogle() {
            document.getElementById('statusMsg').textContent = 'æ­£åœ¨è¿æ¥Google...';
            google.accounts.id.renderButton(
                document.createElement('div'),
                { theme: 'outline', size: 'large' }
            );
            // è§¦å‘Googleç™»å½•æµç¨‹
            const btn = document.querySelector('[data-login-uri]');
            if (btn) btn.click();
        }

        // æ˜¾ç¤ºä»ªè¡¨æ¿
        function showDashboard() {
            if (!currentUser) return;

            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            document.getElementById('currentUser').textContent = currentUser.name + ' (' + currentUser.email + ')';

            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
        }

        // ç™»å‡º
        function logout() {
            currentUser = null;
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('statusMsg').textContent = 'ç³»ç»Ÿå·²å°±ç»ª';
        }
    </script>
</body>
</html>
